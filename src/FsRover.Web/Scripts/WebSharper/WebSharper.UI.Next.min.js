(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Next=c.Next||{};e=d.Array=d.Array||{};f=d.String=d.String||{};g=d.Abbrev=d.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=g.Slot=g.Slot||{};l=g.Async=g.Async||{};m=g.Mailbox=g.Mailbox||{};n=a.StartupCode$WebSharper_UI_Next$Abbrev=a.StartupCode$WebSharper_UI_Next$Abbrev||{};o=d.AppendList=d.AppendList||{};p=a.StartupCode$WebSharper_UI_Next$AppendList=a.StartupCode$WebSharper_UI_Next$AppendList||{};q=d.DomUtility=d.DomUtility||{};r=a.StartupCode$WebSharper_UI_Next$DomUtility=a.StartupCode$WebSharper_UI_Next$DomUtility||{};s=d.Trie=d.Trie||{};t=s.LookupResult=s.LookupResult||{};u=a.StartupCode$WebSharper_UI_Next$Trie=a.StartupCode$WebSharper_UI_Next$Trie||{};v=d.Snap=d.Snap||{};w=d.Var=d.Var||{};x=d.Updates=d.Updates||{};y=d.View=d.View||{};z=d.ViewBuilder=d.ViewBuilder||{};A=d.Submitter=d.Submitter||{};B=d.Key=d.Key||{};C=d.Model=d.Model||{};D=d.Serializer=d.Serializer||{};E=d.Storage=d.Storage||{};F=E.ArrayStorage=E.ArrayStorage||{};G=E.LocalStorageBackend=E.LocalStorageBackend||{};H=d.ListModel=d.ListModel||{};I=d.ListModels=d.ListModels||{};J=a.StartupCode$WebSharper_UI_Next$Models=a.StartupCode$WebSharper_UI_Next$Models||{};K=d.ReactiveExtensions=d.ReactiveExtensions||{};L=d.DoubleInterpolation=d.DoubleInterpolation||{};M=d.Interpolation=d.Interpolation||{};N=d.Easing=d.Easing||{};O=d.Easings=d.Easings||{};P=d.An=d.An||{};Q=d.Anims=d.Anims||{};R=d.Trans=d.Trans||{};S=a.StartupCode$WebSharper_UI_Next$Animation=a.StartupCode$WebSharper_UI_Next$Animation||{};T=d.AnimatedAttrNode=d.AnimatedAttrNode||{};U=d.DynamicAttrNode=d.DynamicAttrNode||{};V=d.AttrProxy=d.AttrProxy||{};W=d.Client=d.Client||{};X=W.Attrs=W.Attrs||{};Y=X.Dyn=X.Dyn||{};Z=d.Attrs=d.Attrs||{};_0=d.CheckedInput=d.CheckedInput||{};_1=d.AttrModule=d.AttrModule||{};_2=a.StartupCode$WebSharper_UI_Next$Attr_Client=a.StartupCode$WebSharper_UI_Next$Attr_Client||{};_3=d.DocElemNode=d.DocElemNode||{};_4=W.Docs=W.Docs||{};_5=_4.DomNodes=_4.DomNodes||{};_6=_4.NodeSet=_4.NodeSet||{};_7=_4.RunState=_4.RunState||{};_8=d.Docs=d.Docs||{};_9=d.Doc=d.Doc||{};_=d.Elt=d.Elt||{};$=W.EltUpdater=W.EltUpdater||{};ba=a.StartupCode$WebSharper_UI_Next$Doc_Client=a.StartupCode$WebSharper_UI_Next$Doc_Client||{};bb=d.Flow=d.Flow||{};bc=d.FlowBuilder=d.FlowBuilder||{};bd=d.Html=d.Html||{};be=bd.attr=bd.attr||{};bf=d.Route=d.Route||{};bg=d.Routing=d.Routing||{};bh=bg.State=bg.State||{};bi=d.RouteMap=d.RouteMap||{};bj=d.Router=d.Router||{};bk=d.Input=d.Input||{};bl=bk.MousePosSt=bk.MousePosSt||{};bm=bk.MouseBtnSt=bk.MouseBtnSt||{};bn=bk.Mouse=bk.Mouse||{};bo=bk.KeyListenerSt=bk.KeyListenerSt||{};bp=bk.Keyboard=bk.Keyboard||{};bq=a.StartupCode$WebSharper_UI_Next$Input=a.StartupCode$WebSharper_UI_Next$Input||{};br=b&&b.List;bs=b&&b.Arrays;bt=b&&b.Enumerator;bu=b&&b.Strings;bv=b&&b.Char;bw=b&&b.Collections;bx=bw&&bw.HashSet;by=b&&b.Seq;bz=a.IntelliFactory;bA=bz&&bz.Runtime;bB=b&&b.Unchecked;bC=a.console;bD=b&&b.Concurrency;bE=bw&&bw.Map;bF=bw&&bw.FSharpMap;bG=bw&&bw.List;bH=b&&b.Operators;bI=b&&b.Queue;bJ=b&&b.Lazy;bK=bw&&bw.Dictionary;bL=a.JSON;bM=b&&b.Numeric;bN=a.Node;bO=a.jQuery;bP=b&&b.Slice;e.mapInPlace=function(bQ,bR){var bS,bT;for(bS=0,bT=bR.length-1;bS<=bT;bS++)bR[bS]=bQ(bR[bS]);return bR;};e.ofSeqNonCopying=function(bQ){var bR,bS;if(bQ instanceof a.Array)return bQ;else if(bQ instanceof br.T)return bs.ofList(bQ);else if(bQ===null)return[];else{bR=[];bS=bt.Get(bQ);try{while(bS.MoveNext())bR.push(bS.Current());return bR;}finally{if("Dispose"in bS)bS.Dispose();}}};e.MapTreeReduce=function(bQ,bR,bS,bT){var bU;function bV(bW,bX){var bY,bZ;return bX<=0?bR:bX===1&&(bW>=0&&bW<bU&&true)?bQ(bs.get(bT,bW)):(bZ=bX/2>>0,bS(bV(bW,bZ),bV(bW+bZ,bX-bZ)));}bU=bs.length(bT);return bV(0,bU);};e.TreeReduce=function(bQ,bR,bS){var bT;function bU(bV,bW){var bX,bY;return bW<=0?bQ:bW===1&&(bV>=0&&bV<bT&&true)?bs.get(bS,bV):(bY=bW/2>>0,bR(bU(bV,bY),bU(bV+bY,bW-bY)));}bT=bs.length(bS);return bU(0,bT);};f.isBlank=function(bQ){return bu.forall(bv.IsWhiteSpace,bQ);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){n.$cctor();return n.counter;};h.set_counter=function(bQ){n.$cctor();n.counter=bQ;};i.Filter=function(bQ,bR){return new bx.New$2(bs.filter(bQ,i.ToArray(bR)));};i.Intersect=function(bQ,bR){var bS;bS=new bx.New$2(i.ToArray(bQ));bS.IntersectWith(i.ToArray(bR));return bS;};i.Except=function(bQ,bR){var bS;bS=new bx.New$2(i.ToArray(bR));bS.ExceptWith(i.ToArray(bQ));return bS;};i.ToArray=function(bQ){var bR;bR=bs.create(bQ.get_Count(),void 0);bQ.CopyTo(bR);return bR;};j.ToValueArray=function(bQ){var bR;bR=bs.create(bQ.count,void 0);by.iteri(function(bS,bT){return bs.set(bR,bS,bT.V);},bQ);return bR;};j.ToKeyArray=function(bQ){var bR;bR=bs.create(bQ.count,void 0);by.iteri(function(bS,bT){return bs.set(bR,bS,bT.K);},bQ);return bR;};k=g.Slot=bA.Class({GetHashCode:function(){return bB.Hash(this.key(this.value));},Equals:function(bQ){return bB.Equals(this.key(this.value),this.key(bQ.get_Value()));},get_Value:function(){return this.value;}},b.Obj,k);k.New=bA.Ctor(function(bQ,bR){this.key=bQ;this.value=bR;},k);k.Create=function(bQ,bR){return new k.New(bQ,bR);};l.OnError=function(bQ){return bC.log("WebSharper UI.Next: Uncaught asynchronous exception",bQ);};l.StartTo=function(bQ,bR){bD.StartWithContinuations(bQ,bR,function(bS){l.OnError(bS);},a.ignore,null);};m.StartProcessor=function(bQ){var bR;function bS(){var bT;bT=null;return bD.Delay(function(){return bD.Bind(bQ,function(){var bU;bU=bR[0];return bB.Equals(bU,1)?(bR[0]=0,bD.Zero()):bB.Equals(bU,2)?(bR[0]=1,bS()):bD.Zero();});});}bR=[0];return function(){var bT;bT=bR[0];bB.Equals(bT,0)?(bR[0]=1,bD.Start(bS(),null)):bB.Equals(bT,1)?bR[0]=2:void 0;};};n.$cctor=function(){n.$cctor=a.ignore;n.counter=0;};o.FromArray=function(bQ){var bR;bR=bQ.length;return bR===0?{$:0}:bR===1?{$:1,$0:bs.get(bQ,0)}:{$:3,$0:bQ.slice()};};o.ToArray=function(bQ){var bR;function bS(bT){if(bT.$==1)bR.push(bT.$0);else if(bT.$==2){bS(bT.$0);bS(bT.$1);}else if(bT.$==3)bs.iter(function(bU){bR.push(bU);},bT.$0);}bR=[];bS(bQ);return bR.slice(0);};o.Single=function(bQ){return{$:1,$0:bQ};};o.Concat=function(bQ){var bR;bR=e.ofSeqNonCopying(bQ);return e.TreeReduce(o.Empty(),o.Append,bR);};o.Append=function(bQ,bR){return bQ.$==0?bR:bR.$==0?bQ:{$:2,$0:bQ,$1:bR};};o.Empty=function(){p.$cctor();return p.Empty;};p.$cctor=function(){p.$cctor=a.ignore;p.Empty={$:0};};q.SetProperty=function(bQ,bR,bS){return bQ.setProperty(bR,bS);};q.IterSelector=function(bQ,bR,bS){var bT,bU,bV;bT=bQ.querySelectorAll(bR);for(bU=0,bV=bT.length-1;bU<=bV;bU++)bS(bT[bU]);};q.ChildrenArray=function(bQ){var bR,bS,bT;bR=[];for(bS=0,bT=bQ.childNodes.length-1;bS<=bT;bS++)bR.push(bQ.childNodes[bS]);return bR;};q.RemoveClass=function(bQ,bR){a.jQuery(bQ).removeClass(bR);};q.AddClass=function(bQ,bR){a.jQuery(bQ).addClass(bR);};q.InsertAt=function(bQ,bR,bS){var bT;if(!(bS.parentNode===bQ&&bR===(bT=bS.nextSibling,bB.Equals(bT,null)?null:bT)))bQ.insertBefore(bS,bR);};q.RemoveNode=function(bQ,bR){if(bR.parentNode===bQ)bQ.removeChild(bR);};q.SetStyle=function(bQ,bR,bS){q.SetProperty(bQ.style,bR,bS);};q.SetAttr=function(bQ,bR,bS){bQ.setAttribute(bR,bS);};q.RemoveAttr=function(bQ,bR){bQ.removeAttribute(bR);};q.CreateAttr=function(bQ,bR){var bS;bS=q.Doc().createAttribute(bQ);bS.value=bR;return bS;};q.CreateText=function(bQ){return q.Doc().createTextNode(bQ);};q.CreateSvgElement=function(bQ){return q.Doc().createElementNS("http://www.w3.org/2000/svg",bQ);};q.CreateElement=function(bQ){return q.Doc().createElement(bQ);};q.Clear=function(bQ){while(bQ.hasChildNodes())bQ.removeChild(bQ.firstChild);};q.ClearAttrs=function(bQ){while(bQ.hasAttributes())bQ.removeAttributeNode(bQ.attributes.item(0));};q.AppendTo=function(bQ,bR){bQ.appendChild(bR);};q.Doc=function(){r.$cctor();return r.Doc;};r.$cctor=function(){r.$cctor=a.ignore;r.Doc=a.document;};t.NotFound={$:1};s.Empty=function(){u.$cctor();return u.Empty;};s.Lookup=function(bQ,bR){return s.Look(br.ofSeq(bR),bQ);};s.Look=function(bQ,bR){var bS,bT;switch(bR.$==2?(bS=bR.$0,0):bR.$==0?bQ.$==1?(bS=[bQ.$0,bQ.$1,bR.$0],1):2:2){case 0:return{$:0,$0:bS,$1:bQ};break;case 1:bT=bE.TryFind(bS[0],bS[2]);return bT==null?t.NotFound:s.Look(bS[1],bT.$0);break;case 2:return t.NotFound;break;}};s.ToArray=function(bQ){var bR;bR=[];s.Map(function(){return function(bS){return bR.push(bS);};},bQ);return bR.slice(0);};s.Mapi=function(bQ,bR){var bS;function bT(){var bU;bU=bS[0];bS[0]=bU+1;return bU;}bS=[0];return s.Map(function(bU){return bQ(bT(),bU);},bR);};s.Map=function(bQ,bR){return s.MapLoop(br.T.Empty,bQ,bR);};s.MapLoop=function(bQ,bR,bS){return bS.$==1?{$:1}:bS.$==2?{$:2,$0:(bR(bQ))(bS.$0)}:s.TrieBranch(bE.Map(function(bT,bU){return s.MapLoop(br.append(bQ,br.ofArray([bT])),bR,bU);},bS.$0));};s.Merge=function(bQ){var bR,bS,bT;bR=e.ofSeqNonCopying(bQ);bS=bs.length(bR);return bS===0?{$:1,$0:{$:1}}:bS===1?{$:1,$0:bs.get(bR,0)}:bs.exists(s.IsLeaf,bR)?null:(bT=s.MergeMaps(s.Merge,by.choose(function(bU){return bU.$==0?{$:1,$0:bU.$0}:null;},bR)),bT==null?null:{$:1,$0:s.TrieBranch(bT.$0)});};s.IsLeaf=function(bQ){return bQ.$==2&&true;};s.MergeMaps=function(bQ,bR){var bS;function bT(bU,bV){var bW;bW=bQ(bV);return bW==null?null:{$:1,$0:[bU,bW.$0]};}bS=s.AllSome(by.map(function(bU){return bT(bU[0],bU[1]);},bE.ToSeq(by.fold(function(bU,bV){return s.MultiAdd(bV[0],bV[1],bU);},new bF.New([]),by.collect(bE.ToSeq,bR)))));return bS==null?null:{$:1,$0:bE.OfArray(bs.ofSeq(bS.$0))};};s.AllSome=function(bQ){var bR,bS,bT,bU;bS=bt.Get(bQ);bT=new bG.New$2();bR=true;while(bR&&bS.MoveNext()){bU=bS.Current();bU!=null&&bU.$==1?bT.Add(bU.$0):bR=false;}return bR?{$:1,$0:bT.ToArray()}:null;};s.MultiAdd=function(bQ,bR,bS){return bS.Add(bQ,new br.T({$:1,$0:bR,$1:s.MultiFind(bQ,bS)}));};s.MultiFind=function(bQ,bR){var bS;bS=bE.TryFind(bQ,bR);return bS==null?br.T.Empty:bS.$0;};s.Prefix=function(bQ,bR){return s.TrieBranch(new bF.New(br.ofArray([[bQ,bR]])));};s.Leaf=function(bQ){return{$:2,$0:bQ};};s.TrieBranch=function(bQ){return bQ.get_IsEmpty()?{$:1}:{$:0,$0:bQ};};u.$cctor=function(){u.$cctor=a.ignore;u.Empty={$:1};};v.Obsolete=function(bQ){var bR,bS,bT,bU,bV;bS=bQ.s;if(bS==null||(bS!=null&&bS.$==2?(bR=bS.$1,false):bS!=null&&bS.$==3?(bR=bS.$1,false):true))void 0;else{bQ.s=null;for(bT=0,bU=bs.length(bR)-1;bT<=bU;bT++){bV=bs.get(bR,bT);typeof bV=="object"?function(bW){v.Obsolete(bW);}(bV):bV();}}};v.New=function(bQ){return{s:bQ};};v.MapAsync=function(bQ,bR){var bS;bS=v.New({$:3,$0:[],$1:[]});v.When(bR,function(bT){l.StartTo(bQ(bT),function(bU){v.MarkDone(bS,bR,bU);});},bS);return bS;};v.SnapshotOn=function(bQ,bR){var bS;function bT(bU){var bV,bW,bX;if(!(bV=bS.s,bV!=null&&bV.$==0||bV!=null&&bV.$==2&&true)){bW=v.ValueAndForever(bQ);bX=v.ValueAndForever(bR);bW!=null&&bW.$==1?bX!=null&&bX.$==1?bW.$0[1]||bX.$0[1]?v.MarkForever(bS,bX.$0[0]):v.MarkReady(bS,bX.$0[0]):void 0:void 0;}}bS=v.New({$:3,$0:[],$1:[]});v.When(bQ,bT,bS);v.WhenReady(bR,bT);return bS;};v.Map3=function(bQ,bR,bS,bT){var bU,bV,bW,bX;function bY(bZ){var b0,b1,b2,b3;if(!(b0=bX.s,b0!=null&&b0.$==0||b0!=null&&b0.$==2&&true)){b1=v.ValueAndForever(bR);b2=v.ValueAndForever(bS);b3=v.ValueAndForever(bT);b1!=null&&b1.$==1?b2!=null&&b2.$==1?b3!=null&&b3.$==1?b1.$0[1]&&b2.$0[1]&&b3.$0[1]?v.MarkForever(bX,bQ(b1.$0[0],b2.$0[0],b3.$0[0])):v.MarkReady(bX,bQ(b1.$0[0],b2.$0[0],b3.$0[0])):void 0:void 0:void 0;}}bU=bR.s;bV=bS.s;bW=bT.s;return bU!=null&&bU.$==0?bV!=null&&bV.$==0?bW!=null&&bW.$==0?v.New({$:0,$0:bQ(bU.$0,bV.$0,bW.$0)}):v.Map3Opt1(bQ,bU.$0,bV.$0,bT):bW!=null&&bW.$==0?v.Map3Opt2(bQ,bU.$0,bW.$0,bS):v.Map3Opt3(bQ,bU.$0,bS,bT):bV!=null&&bV.$==0?bW!=null&&bW.$==0?v.Map3Opt4(bQ,bV.$0,bW.$0,bR):v.Map3Opt5(bQ,bV.$0,bR,bT):bW!=null&&bW.$==0?v.Map3Opt6(bQ,bW.$0,bR,bS):(bX=v.New({$:3,$0:[],$1:[]}),(v.When(bR,bY,bX),v.When(bS,bY,bX),v.When(bT,bY,bX),bX));};v.Map3Opt6=function(bQ,bR,bS,bT){return v.Map2(function(bU,bV){return bQ(bU,bV,bR);},bS,bT);};v.Map3Opt5=function(bQ,bR,bS,bT){return v.Map2(function(bU,bV){return bQ(bU,bR,bV);},bS,bT);};v.Map3Opt4=function(bQ,bR,bS,bT){return v.Map(function(bU){return bQ(bU,bR,bS);},bT);};v.Map3Opt3=function(bQ,bR,bS,bT){return v.Map2(function(bU,bV){return bQ(bR,bU,bV);},bS,bT);};v.Map3Opt2=function(bQ,bR,bS,bT){return v.Map(function(bU){return bQ(bR,bU,bS);},bT);};v.Map3Opt1=function(bQ,bR,bS,bT){return v.Map(function(bU){return bQ(bR,bS,bU);},bT);};v.Map2Unit=function(bQ,bR){var bS,bT,bU;function bV(){var bW,bX,bY;if(!(bW=bU.s,bW!=null&&bW.$==0||bW!=null&&bW.$==2&&true)){bX=v.ValueAndForever(bQ);bY=v.ValueAndForever(bR);bX!=null&&bX.$==1?bY!=null&&bY.$==1?bX.$0[1]&&bY.$0[1]?v.MarkForever(bU,null):v.MarkReady(bU,null):void 0:void 0;}}bS=bQ.s;bT=bR.s;return bS!=null&&bS.$==0?bT!=null&&bT.$==0?v.New({$:0,$0:null}):bR:bT!=null&&bT.$==0?bQ:(bU=v.New({$:3,$0:[],$1:[]}),(v.When(bQ,bV,bU),v.When(bR,bV,bU),bU));};v.Map2=function(bQ,bR,bS){var bT,bU,bV;function bW(bX){var bY,bZ,b0;if(!(bY=bV.s,bY!=null&&bY.$==0||bY!=null&&bY.$==2&&true)){bZ=v.ValueAndForever(bR);b0=v.ValueAndForever(bS);bZ!=null&&bZ.$==1?b0!=null&&b0.$==1?bZ.$0[1]&&b0.$0[1]?v.MarkForever(bV,bQ(bZ.$0[0],b0.$0[0])):v.MarkReady(bV,bQ(bZ.$0[0],b0.$0[0])):void 0:void 0;}}bT=bR.s;bU=bS.s;return bT!=null&&bT.$==0?bU!=null&&bU.$==0?v.New({$:0,$0:bQ(bT.$0,bU.$0)}):v.Map2Opt1(bQ,bT.$0,bS):bU!=null&&bU.$==0?v.Map2Opt2(bQ,bU.$0,bR):(bV=v.New({$:3,$0:[],$1:[]}),(v.When(bR,bW,bV),v.When(bS,bW,bV),bV));};v.Map2Opt2=function(bQ,bR,bS){return v.Map(function(bT){return bQ(bT,bR);},bS);};v.Map2Opt1=function(bQ,bR,bS){return v.Map(function(bT){return bQ(bR,bT);},bS);};v.MapCachedBy=function(bQ,bR,bS,bT){return v.Map(function(bU){var bV,bW,bX;bV=bR[0];return bV!=null&&bV.$==1&&(bQ(bU,bV.$0[0])&&(bW=[bV.$0[0],bV.$0[1]],true))?bW[1]:(bX=bS(bU),(bR[0]={$:1,$0:[bU,bX]},bX));},bT);};v.Copy=function(bQ){var bR,bS,bT;bR=bQ.s;return bR==null?bQ:bR!=null&&bR.$==2?(bS=v.New({$:2,$0:bR.$0,$1:[]}),(v.WhenObsolete(bQ,bS),bS)):bR!=null&&bR.$==3?(bT=v.New({$:3,$0:[],$1:[]}),(v.When(bQ,function(bU){v.MarkDone(bT,bQ,bU);},bT),bT)):bQ;};v.Map=function(bQ,bR){var bS,bT;bS=bR.s;return bS!=null&&bS.$==0?v.New({$:0,$0:bQ(bS.$0)}):(bT=v.New({$:3,$0:[],$1:[]}),(v.When(bR,function(bU){v.MarkDone(bT,bR,bQ(bU));},bT),bT));};v.Sequence=function(bQ){var bR,bS,bT;function bU(bV){var bW;if(bT[0]===0){bW=bs.map(function(bX){var bY;bY=bX.s;return bY!=null&&bY.$==0?bY.$0:bY!=null&&bY.$==2?bY.$0:bH.FailWith("value not found by View.Sequence");},bR);bs.forall(function(bX){var bY;return(bY=bX.s,bY!=null&&bY.$==0)&&true;},bR)?v.MarkForever(bS,bW):v.MarkReady(bS,bW);}else bT[0]--;}bR=bs.ofSeq(bQ);return bR.length==0?v.New({$:0,$0:[]}):(bS=v.New({$:3,$0:[],$1:[]}),(bT=[bs.length(bR)-1],(bs.iter(function(bV){v.When(bV,bU,bS);},bR),bS)));};v.CreateForeverAsync=function(bQ){var bR;bR=v.New({$:3,$0:[],$1:[]});l.StartTo(bQ,function(bS){v.MarkForever(bR,bS);});return bR;};v.JoinInner=function(bQ){var bR;bR=v.New({$:3,$0:[],$1:[]});v.When(bQ,function(bS){var bT;bT=bS();v.When(bT,function(bU){var bV,bW;if((bV=bT.s,bV!=null&&bV.$==0)&&true&&((bW=bQ.s,bW!=null&&bW.$==0)&&true))v.MarkForever(bR,bU);else v.MarkReady(bR,bU);},bR);v.WhenObsolete(bQ,bT);},bR);return bR;};v.Join=function(bQ){var bR;bR=v.New({$:3,$0:[],$1:[]});v.When(bQ,function(bS){var bT;bT=bS();v.When(bT,function(bU){var bV,bW;if((bV=bT.s,bV!=null&&bV.$==0)&&true&&((bW=bQ.s,bW!=null&&bW.$==0)&&true))v.MarkForever(bR,bU);else v.MarkReady(bR,bU);},bR);},bR);return bR;};v.ValueAndForever=function(bQ){var bR;bR=bQ.s;return bR!=null&&bR.$==0?{$:1,$0:[bR.$0,true]}:bR!=null&&bR.$==2?{$:1,$0:[bR.$0,false]}:null;};v.WhenObsoleteRun=function(bQ,bR){var bS;bS=bQ.s;bS==null?bR():bS!=null&&bS.$==2?bS.$1.push(bR):bS!=null&&bS.$==3?bS.$1.push(bR):void 0;};v.WhenObsolete=function(bQ,bR){var bS;bS=bQ.s;bS==null?v.Obsolete(bR):bS!=null&&bS.$==2?v.EnqueueSafe(bS.$1,bR):bS!=null&&bS.$==3?v.EnqueueSafe(bS.$1,bR):void 0;};v.WhenReady=function(bQ,bR){var bS,bT;bT=bQ.s;switch(bT!=null&&bT.$==2?(bS=bT.$0,0):bT==null?1:bT!=null&&bT.$==3?2:(bS=bT.$0,0)){case 0:bR(bS);break;case 1:null;break;case 2:bT.$0.push(bR);break;}};v.WhenRun=function(bQ,bR,bS){var bT;bT=bQ.s;bT==null?bS():bT!=null&&bT.$==2?(bT.$1.push(bS),bR(bT.$0)):bT!=null&&bT.$==3?(bT.$0.push(bR),bT.$1.push(bS)):bR(bT.$0);};v.When=function(bQ,bR,bS){var bT;bT=bQ.s;bT==null?v.Obsolete(bS):bT!=null&&bT.$==2?(v.EnqueueSafe(bT.$1,bS),bR(bT.$0)):bT!=null&&bT.$==3?(bT.$0.push(bR),v.EnqueueSafe(bT.$1,bS)):bR(bT.$0);};v.EnqueueSafe=function(bQ,bR){var bS,bT,bU,bV;bQ.push(bR);if(bQ.length%20===0){bS=bQ.slice(0);bI.Clear(bQ);for(bT=0,bU=bs.length(bS)-1;bT<=bU;bT++){bV=bs.get(bS,bT);typeof bV=="object"?function(bW){if(bW.s)bQ.push(bW);}(bV):function(bW){bQ.push(bW);}(bV);}}else void 0;};v.MarkDone=function(bQ,bR,bS){var bT;if((bT=bR.s,bT!=null&&bT.$==0)&&true)v.MarkForever(bQ,bS);else v.MarkReady(bQ,bS);};v.MarkReady=function(bQ,bR){var bS,bT,bU,bV;bS=bQ.s;if(bS!=null&&bS.$==3){bQ.s={$:2,$0:bR,$1:bS.$1};bT=bS.$0;for(bU=0,bV=bs.length(bT)-1;bU<=bV;bU++)(bs.get(bT,bU))(bR);}else void 0;};v.MarkForever=function(bQ,bR){var bS,bT,bU,bV;bS=bQ.s;if(bS!=null&&bS.$==3){bQ.s={$:0,$0:bR};bT=bS.$0;for(bU=0,bV=bs.length(bT)-1;bU<=bV;bU++)(bs.get(bT,bU))(bR);}else void 0;};w=d.Var=bA.Class({RId:function(){return"uinref"+a.String(this.i);},RView:function(){return this.v;},RUpdM:function(bQ){var bR;bR=bQ(this.c);bR!=null&&bR.$==1?w.Set(this,bR.$0):void 0;},RUpd:function(bQ){w.Update(this,bQ);},set_RVal:function(bQ){w.Set(this,bQ);},RVal:function(){return this.c;},RSet:function(bQ){w.Set(this,bQ);},RGet:function(){return this.c;}},null,w);w.New=function(bQ,bR,bS,bT,bU){return new w({o:bQ,c:bR,s:bS,i:bT,v:bU});};w.Lens=function(bQ,bR,bS){var bT,bU;bT=h.Id();bU=y.Map(bR,bQ.RView());return{RGet:function(){return bR(bQ.RGet());},RSet:function(bV){return bQ.RUpd(function(bW){return bS(bW,bV);});},RVal:function(){return bR(bQ.RGet());},set_RVal:function(bV){return bQ.RUpd(function(bW){return bS(bW,bV);});},RUpd:function(bV){return bQ.RUpd(function(bW){return bS(bW,bV(bR(bW)));});},RUpdM:function(bV){return bQ.RUpdM(function(bW){var bX;bX=bV(bR(bW));return bX==null?null:{$:1,$0:bS(bW,bX.$0)};});},RView:function(){return bU;},RId:function(){return bT;}};};w.Update=function(bQ,bR){w.Set(bQ,bR(bQ.c));};w.SetFinal=function(bQ,bR){if(bQ.o)(function(bS){return bS("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bS){bC.log(bS);}));else{v.Obsolete(bQ.s);bQ.o=true;bQ.c=bR;bQ.s=v.New({$:0,$0:bR});}};w.Set=function(bQ,bR){if(bQ.o)(function(bS){return bS("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bS){bC.log(bS);}));else{v.Obsolete(bQ.s);bQ.c=bR;bQ.s=v.New({$:2,$0:bR,$1:[]});}};w.Create=function(){var bQ;bQ=null;bQ=w.New(false,null,v.New({$:2,$0:null,$1:[]}),h.Int(),function(){return bQ.s;});return bQ;};w.CreateLogged=function(bQ,bR){var bS;!window.UINVars?window.UINVars=[]:void 0;bS=w.Create$1(bR);window.UINVars.push([bQ,bS]);return bS;};w.Create$1=function(bQ){var bR;bR=null;bR=w.New(false,bQ,v.New({$:2,$0:bQ,$1:[]}),h.Int(),function(){return bR.s;});return bR;};x=d.Updates=bA.Class({set_Value:function(bQ){var bR;bR=this.s;!(bR===null)?v.Obsolete(bR):void 0;this.c=bQ;}},null,x);x.Create=function(bQ){var bR;bR=null;bR=x.New(bQ,null,function(){var bS;bS=bR.s;return bS===null?(bS=v.Copy(bR.c()),bR.s=bS,v.WhenObsoleteRun(bS,function(){bR.s=null;}),bS):bS;});return bR;};x.New=function(bQ,bR,bS){return new x({c:bQ,s:bR,v:bS});};y.get_Do=function(){return z.B;};y.Apply=function(bQ,bR){return y.Map2(function(bS,bT){return bS(bT);},bQ,bR);};y.AsyncAwait=function(bQ,bR){function bS(bT){var bU,bV;function bW(){return y.RemovableSink(function(bX){if(bQ(bX)){(bJ.Force(bU))();bT(bX);}},bR);}bU=bJ.Create(bW);bV=bJ.Force(bU);}return bD.FromContinuations(function(bT,bU,bV){return bS.apply(null,[bT,bU,bV]);});};y.RemovableSink=function(bQ,bR){var bS;function bT(){v.WhenRun(bR(),function(bU){if(bS[0])bQ(bU);},function(){if(bS[0])bD.scheduler().Fork(bT);});}bS=[true];bD.scheduler().Fork(bT);return function(){bS[0]=false;};};y.Sink=function(bQ,bR){function bS(){v.WhenRun(bR(),bQ,function(){bD.scheduler().Fork(bS);});}bD.scheduler().Fork(bS);};y.TryFinally=function(bQ,bR){return y.CreateLazy(function(){try{return bR();}finally{bQ();}});};y.TryWith=function(bQ,bR){return y.CreateLazy(function(){try{return bR();}catch(bS){return(bQ(bS))();}});};y.ConstAsync=function(bQ){var bR;bR=v.CreateForeverAsync(bQ);return function(){return bR;};};y.Const=function(bQ){var bR;bR=v.New({$:0,$0:bQ});return function(){return bR;};};y.Sequence=function(bQ){return y.CreateLazy(function(){return v.Sequence(by.map(function(bR){return bR();},bQ));});};y.UpdateWhile=function(bQ,bR,bS){var bT;bT=[bQ];return y.BindInner(function(bU){return bU?y.Map(function(bV){bT[0]=bV;return bV;},bS):y.Const(bT[0]);},bR);};y.BindInner=function(bQ,bR){return y.JoinInner(y.Map(bQ,bR));};y.JoinInner=function(bQ){return y.CreateLazy(function(){return v.JoinInner(bQ());});};y.Bind=function(bQ,bR){return y.Join(y.Map(bQ,bR));};y.Join=function(bQ){return y.CreateLazy(function(){return v.Join(bQ());});};y.MapSeqCachedView=function(bQ,bR){function bS(bT){return bQ;}return y.MapSeqCachedViewBy(a.id,function(bT,bU){return(bS(bT))(bU);},bR);};y.MapSeqCachedViewBy=function(bQ,bR,bS){var bT;bT=[new bK.New$5()];return y.Map(function(bU){var bV,bW,bX;bV=bT[0];bW=new bK.New$5();bX=e.mapInPlace(function(bY){var bZ,b0,b1;bZ=bQ(bY);b0=bV.ContainsKey(bZ)?(b1=bV.get_Item(bZ),(w.Set(b1.r,bY),b1)):y.ConvertSeqNode(function(b2){return bR(bZ,b2);},bY);bW.set_Item(bZ,b0);return b0.e;},bs.ofSeq(bU));bT[0]=bW;return bX;},bS);};y.ConvertSeqNode=function(bQ,bR){var bS,bT;bS=w.Create$1(bR);bT=bS.v;return{e:bQ(bT),r:bS,w:bT};};y.MapSeqCached=function(bQ,bR){return y.MapSeqCachedBy(a.id,bQ,bR);};y.MapSeqCachedBy=function(bQ,bR,bS){var bT;bT=[new bK.New$5()];return y.Map(function(bU){var bV,bW,bX;bV=bT[0];bW=new bK.New$5();bX=e.mapInPlace(function(bY){var bZ,b0;bZ=bQ(bY);b0=bV.ContainsKey(bZ)?bV.get_Item(bZ):bR(bY);bW.set_Item(bZ,b0);return b0;},bs.ofSeq(bU));bT[0]=bW;return bX;},bS);};y.SnapshotOn=function(bQ,bR,bS){var bT;bT=v.New({$:2,$0:bQ,$1:[]});return y.CreateLazy(function(){return bT.s==null&&true?v.SnapshotOn(bR(),bS()):(v.WhenObsolete(bR(),bT),bT);});};y.GetAsync=function(bQ){return bD.FromContinuations(function(bR){return y.Get(bR,bQ);});};y.Get=function(bQ,bR){var bS;function bT(){v.WhenRun(bR(),function(bU){if(!bS[0]){bS[0]=true;bQ(bU);}},function(){if(!bS[0])bT();});}bS=[false];bT();};y.MapAsync2=function(bQ,bR,bS){return y.MapAsync(a.id,y.Map2(bQ,bR,bS));};y.MapAsync=function(bQ,bR){return y.CreateLazy(function(){return v.MapAsync(bQ,bR());});};y.Map3=function(bQ,bR,bS,bT){return y.CreateLazy(function(){return v.Map3(bQ,bR(),bS(),bT());});};y.Map2Unit=function(bQ,bR){return y.CreateLazy(function(){return v.Map2Unit(bQ(),bR());});};y.Map2=function(bQ,bR,bS){return y.CreateLazy(function(){return v.Map2(bQ,bR(),bS());});};y.MapCached=function(bQ,bR){return y.MapCachedBy(bB.Equals,bQ,bR);};y.MapCachedBy=function(bQ,bR,bS){var bT;bT=[null];return y.CreateLazy(function(){return v.MapCachedBy(bQ,bT,bR,bS());});};y.Map=function(bQ,bR){return y.CreateLazy(function(){return v.Map(bQ,bR());});};y.CreateLazy=function(bQ){var bR;bR={c:null,o:bQ};return function(){var bS,bT;bS=bR.c;return bS===null?(bS=bR.o(),bR.c=bS,(bT=bS.s,bT!=null&&bT.$==0)&&true?bR.o=null:v.WhenObsoleteRun(bS,function(){bR.c=null;}),bS):bS;};};z.B={$:0};A=d.Submitter=bA.Class({Trigger:function(){w.Set(this["var"],null);}},b.Obj,A);A.New=bA.Ctor(function(bQ,bR){this.input=bQ;this["var"]=w.Create();this.view=y.SnapshotOn(bR,this["var"].v,this.input);},A);A.CreateOption=function(bQ){return new A.New(y.Map(function(bR){return{$:1,$0:bR};},bQ),null);};B.Fresh=function(){return{$:0,$0:h.Int()};};C=d.Model=bA.Class({},b.Obj,C);C.New=bA.Ctor(function(bQ,bR){var bS;bS=w.Create$1(bR);C.New$1.call(this,bS,y.Map(bQ,bS.v));},C);C.New$1=bA.Ctor(function(bQ,bR){this["var"]=bQ;this.view=bR;},C);C.Update=function(bQ,bR){w.Update(bR["var"],function(bS){bQ(bS);return bS;});};C.Create=function(bQ,bR){return new C.New(bQ,bR);};D.Default=function(){J.$cctor();return J.Default;};F=E.ArrayStorage=bA.Class({SSet:function(bQ){return bs.ofSeq(bQ);},SSetAt:function(bQ,bR,bS){bs.set(bS,bQ,bR);return bS;},SRemoveIf:function(bQ,bR){return bs.filter(function(bS){return!bQ(bS);},bR);},SInit:function(){return this.init;},SPrependMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.unshift.apply(bR,bS);return bR;},SPrepend:function(bQ,bR){bR.unshift(bQ);return bR;},SAppendMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.push.apply(bR,bS);return bR;},SAppend:function(bQ,bR){bR.push(bQ);return bR;}},b.Obj,F);F.New=bA.Ctor(function(bQ){this.init=bQ;},F);G=E.LocalStorageBackend=bA.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bQ){this.storage.setItem(this.id,bL.stringify(bs.map(this.serializer.Encode,bQ)));return bQ;},SSet:function(bQ){return this.set(bs.ofSeq(bQ));},SSetAt:function(bQ,bR,bS){bs.set(bS,bQ,bR);return this.set(bS);},SRemoveIf:function(bQ,bR){return this.set(bs.filter(function(bS){return!bQ(bS);},bR));},SInit:function(){var bQ;bQ=this.storage.getItem(this.id);if(bQ===null)return[];else try{return bs.map(this.serializer.Decode,bL.parse(bQ));}catch(bR){return[];}},SPrependMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.unshift.apply(bR,bS);return this.set(bR);},SPrepend:function(bQ,bR){bR.unshift(bQ);return this.set(bR);},SAppendMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.push.apply(bR,bS);return this.set(bR);},SAppend:function(bQ,bR){bR.push(bQ);return this.set(bR);}},b.Obj,G);G.New=bA.Ctor(function(bQ,bR){this.id=bQ;this.serializer=bR;this.storage=a.localStorage;},G);E.LocalStorage=function(bQ,bR){return new G.New(bQ,bR);};E.InMemory=function(bQ){return new F.New(bQ);};H=d.ListModel=bA.Class({Wrap:function(bQ,bR,bS){return H.Wrap(this,bQ,bR,bS);},Lens:function(bQ){return this.LensInto(a.id,function(bR,bS){return bS;},bQ);},LensInto:function(bQ,bR,bS){var bT,bU,bV;bT=this;bU=h.Id();bV=y.Map(bQ,this.FindByKeyAsView(bS));return{RGet:function(){return bQ(bT.FindByKey(bS));},RSet:function(bW){return bT.UpdateBy(function(bX){return{$:1,$0:bR(bX,bW)};},bS);},RVal:function(){return this.RGet();},set_RVal:function(bW){return this.RSet(bW);},RUpd:function(bW){return bT.UpdateBy(function(bX){return{$:1,$0:bR(bX,bW(bQ(bX)))};},bS);},RUpdM:function(bW){return bT.UpdateBy(function(bX){var bY;bY=bW(bQ(bX));return bY==null?null:{$:1,$0:bR(bX,bY.$0)};},bS);},RView:function(){return bV;},RId:function(){return bU;}};},get_LengthAsView:function(){return y.Map(bs.length,this["var"].RView());},get_Length:function(){return bs.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bQ,bR){var bS,bT,bU,bV,bW;bS=this;bT=this["var"].RVal();bU=bs.tryFindIndex(function(bX){return bB.Equals(bS.key(bX),bR);},bT);bU!=null&&bU.$==1?(bV=bU.$0,bW=bQ(bs.get(bT,bV)),bW!=null&&bW.$==1?(this["var"].set_RVal(this.storage.SSetAt(bV,bW.$0,bT)),this.ObsoleteKey(bR)):void 0):void 0;},UpdateAll:function(bQ){var bR;bR=this;this["var"].RUpd(function(bS){bs.iteri(function(bT,bU){var bV;bV=bQ(bU);return bV==null?null:bs.set(bS,bT,bV.$0);},bS);return bR.storage.SSet(bS);});this.ObsoleteAll();},FindByKeyAsView:function(bQ){return y.Map(function(bR){return bR.$0;},this.TryFindByKeyAsView(bQ));},TryFindByKeyAsView:function(bQ){var bR;bR=this;return function(){var bS,bT,bU;bS=(bT=null,[bR.it.TryGetValue(bQ,{get:function(){return bT;},set:function(bV){bT=bV;}}),bT]);return bS[0]?bS[1]:(bU=v.New({$:2,$0:bR.TryFindByKey(bQ),$1:[]}),(bR.it.Add(bQ,bU),bU));};},TryFindByKey:function(bQ){var bR;bR=this;return bs.tryFind(function(bS){return bB.Equals(bR.key(bS),bQ);},this["var"].RVal());},FindByKey:function(bQ){var bR;bR=this;return bs.find(function(bS){return bB.Equals(bR.key(bS),bQ);},this["var"].RVal());},TryFindAsView:function(bQ){return y.Map(function(bR){return bs.tryFind(bQ,bR);},this["var"].RView());},FindAsView:function(bQ){return y.Map(function(bR){return bs.find(bQ,bR);},this["var"].RView());},TryFind:function(bQ){return bs.tryFind(bQ,this["var"].RVal());},Find:function(bQ){return bs.find(bQ,this["var"].RVal());},ContainsKeyAsView:function(bQ){var bR;function bS(bT){return bB.Equals(bR.key(bT),bQ);}bR=this;return y.Map(function(bT){return bs.exists(bS,bT);},this["var"].RView());},ContainsKey:function(bQ){var bR;bR=this;return bs.exists(function(bS){return bB.Equals(bR.key(bS),bQ);},this["var"].RVal());},Set:function(bQ){this["var"].set_RVal(this.storage.SSet(bQ));this.ObsoleteAll();},Iter:function(bQ){bs.iter(bQ,this["var"].RVal());},RemoveByKey:function(bQ){var bR;bR=this;this["var"].set_RVal(this.storage.SRemoveIf(function(bS){return bB.Equals(bR.key(bS),bQ);},this["var"].RVal()));this.ObsoleteKey(bQ);},RemoveBy:function(bQ){var bR,bS,bT,bU;bR=this["var"].RVal();for(bS=0,bT=bR.length-1;bS<=bT;bS++){bU=bs.get(bR,bS);bQ(bU)?this.ObsoleteKey(this.key(bU)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(bQ,this["var"].RVal()));},Remove:function(bQ){var bR,bS,bT,bU;bR=this;bS=this["var"].RVal();I.Contains(bR.key,bQ,bS)?(bT=bR.key,bU=bT(bQ),this["var"].set_RVal(this.storage.SRemoveIf(function(bV){return bB.Equals(bT(bV),bU);},bS)),this.ObsoleteKey(bU)):void 0;},PrependMany:function(bQ){var bR,bS;function bT(bU,bV){var bW,bX;bW=bR.key(bV);bR.ObsoleteKey(bW);bX=bs.tryFindIndex(function(bY){return bB.Equals(bR.key(bY),bW);},bU);return bX==null?(bS.Add(bV),bU):bR.storage.SSetAt(bX.$0,bV,bU);}bR=this;bS=new bG.New$2();this["var"].set_RVal(this.storage.SPrependMany(bS,(((bA.Curried3(by.fold))(bT))(this["var"].RVal()))(bQ)));},Prepend:function(bQ){var bR,bS,bT,bU;bR=this;bS=this["var"].RVal();bT=this.key(bQ);bU=bs.tryFindIndex(function(bV){return bB.Equals(bR.key(bV),bT);},bS);bU!=null&&bU.$==1?this["var"].set_RVal(this.storage.SSetAt(bU.$0,bQ,bS)):this["var"].set_RVal(this.storage.SPrepend(bQ,bS));this.ObsoleteKey(bT);},AppendMany:function(bQ){var bR,bS;function bT(bU,bV){var bW,bX;bW=bR.key(bV);bR.ObsoleteKey(bW);bX=bs.tryFindIndex(function(bY){return bB.Equals(bR.key(bY),bW);},bU);return bX==null?(bS.Add(bV),bU):bR.storage.SSetAt(bX.$0,bV,bU);}bR=this;bS=new bG.New$2();this["var"].set_RVal(this.storage.SAppendMany(bS,(((bA.Curried3(by.fold))(bT))(this["var"].RVal()))(bQ)));},Append:function(bQ){var bR,bS,bT,bU;bR=this;bS=this["var"].RVal();bT=this.key(bQ);bU=bs.tryFindIndex(function(bV){return bB.Equals(bR.key(bV),bT);},bS);bU!=null&&bU.$==1?this["var"].set_RVal(this.storage.SSetAt(bU.$0,bQ,bS)):this["var"].set_RVal(this.storage.SAppend(bQ,bS));this.ObsoleteKey(bT);},ObsoleteAll:function(){by.iter(function(bQ){v.Obsolete(bQ.V);},this.it);this.it.Clear();},ObsoleteKey:function(bQ){var bR,bS;bR=(bS=null,[this.it.TryGetValue(bQ,{get:function(){return bS;},set:function(bT){bS=bT;}}),bS]);bR[0]?(v.Obsolete(bR[1]),this.it.Remove(bQ)):void 0;},GetEnumerator0:function(){return bt.Get0(this["var"].RVal());},GetEnumerator:function(){return bt.Get(this["var"].RVal());}},b.Obj,H);H.New=bA.Ctor(function(bQ,bR){H.New$3.call(this,bQ,w.Create$1(bs.ofSeq(by.distinctBy(bQ,bR.SInit()))),bR);},H);H.New$1=bA.Ctor(function(bQ){H.New$2.call(this,bQ,[]);},H);H.New$2=bA.Ctor(function(bQ,bR){var bS;bS=bs.ofSeq(bR);H.New$3.call(this,bQ,w.Create$1(bS),E.InMemory(bS));},H);H.New$3=bA.Ctor(function(bQ,bR,bS){this.key=bQ;this["var"]=bR;this.storage=bS;this.v=y.Map(function(bT){return bT.slice();},this["var"].RView());this.it=new bK.New$5();},H);I.Contains=function(bQ,bR,bS){var bT;bT=bQ(bR);return bs.exists(function(bU){return bB.Equals(bQ(bU),bT);},bS);};H.Wrap=function(bQ,bR,bS,bT){var bU,bV;bU=[new bK.New$5()];bV=bs.map(function(bW){var bX;bX=bS(bW);bU[0].set_Item(bQ.key(bW),bX);return bX;},bQ["var"].RVal());return new H.New$3(function(bW){return bQ.key(bR(bW));},w.Lens(bQ["var"],function(bW){var bX,bY;bX=new bK.New$5();bY=bs.map(function(bZ){var b0,b1;b0=bQ.key(bZ);b1=bU[0].ContainsKey(b0)?bT(bU[0].get_Item(b0),bZ):bS(bZ);bX.set_Item(b0,b1);return b1;},bW);bU[0]=bX;return bY;},function(bW,bX){var bY,bZ;bY=new bK.New$5();bZ=bs.map(function(b0){var b1;b1=bR(b0);bY.set_Item(bQ.key(b1),b0);return b1;},bX);bU[0]=bY;return bZ;}),E.InMemory(bV));};H.FromSeq=function(bQ){return H.Create(a.id,bQ);};H.Create=function(bQ,bR){return H.CreateWithStorage(bQ,E.InMemory(bs.ofSeq(bR)));};H.CreateWithStorage=function(bQ,bR){return new H.New(bQ,bR);};J.$cctor=function(){J.$cctor=a.ignore;J.Default={Encode:a.id,Decode:a.id};};K=d.ReactiveExtensions=bA.Class({},b.Obj,K);K.New=bA.Ctor(function(){},K);L=d.DoubleInterpolation=bA.Class({Interpolate:function(bQ,bR,bS){return bR+bQ*(bS-bR);}},null,L);L.DoubleInterpolation=new L({$:0});M.get_Double=function(){return L.DoubleInterpolation;};N=d.Easing=bA.Class({TransformTime:function(bQ){return this.transformTime(bQ);}},b.Obj,N);N.get_CubicInOut=function(){return O.CubicInOut();};N.Custom=function(bQ){return new N.New(bQ);};N.New=bA.Ctor(function(bQ){this.transformTime=bQ;},N);O.CubicInOut=function(){S.$cctor();return S.CubicInOut;};P.get_Empty=function(){return{$:0,$0:o.Empty()};};P.WhenDone=function(bQ,bR){return P.Append({$:0,$0:o.Single({$:0,$0:bQ})},bR);};P.Run=function(bQ,bR){var bS;function bT(bU){function bV(bW,bX){var bY;bY=bX-bW;bR.Compute(bY);bQ();return bY<=bS?void a.requestAnimationFrame(function(bZ){bV(bW,bZ);}):bU();}a.requestAnimationFrame(function(bW){bV(bW,bW);});}bS=bR.Duration;return bS===0?bD.Zero():bD.FromContinuations(function(bU,bV,bW){return bT.apply(null,[bU,bV,bW]);});};P.Play=function(bQ){var bR;bR=null;return bD.Delay(function(){return bD.Bind(P.Run(a.ignore,Q.Actions(bQ)),function(){Q.Finalize(bQ);return bD.Return(null);});});};P.Pack=function(bQ){return{$:0,$0:o.Single({$:1,$0:bQ})};};P.Map=function(bQ,bR){var bS;return Q.Def(bR.Duration,(bS=bR.Compute,function(bT){return bQ(bS(bT));}));};P.Delayed=function(bQ,bR,bS,bT,bU,bV){return{Compute:function(bW){return bW<=bT?bU:bQ.Interpolate(bR.TransformTime((bW-bT)/bS),bU,bV);},Duration:bS+bT};};P.Simple=function(bQ,bR,bS,bT,bU){return{Compute:function(bV){return bQ.Interpolate(bR.TransformTime(bV/bS),bT,bU);},Duration:bS};};P.Const=function(bQ){return Q.Const(bQ);};P.Concat=function(bQ){return{$:0,$0:o.Concat(by.map(Q.List,bQ))};};P.Append=function(bQ,bR){return{$:0,$0:o.Append(bQ.$0,bR.$0)};};P.set_UseAnimations=function(bQ){Q.set_UseAnimations(bQ);};P.get_UseAnimations=function(){return Q.UseAnimations();};Q.UseAnimations=function(){S.$cctor();return S.UseAnimations;};Q.set_UseAnimations=function(bQ){S.$cctor();S.UseAnimations=bQ;};Q.Actions=function(bQ){return Q.ConcatActions(bs.choose(function(bR){return bR.$==1?{$:1,$0:bR.$0}:null;},o.ToArray(bQ.$0)));};Q.ConcatActions=function(bQ){var bR,bS,bT,bU;bR=e.ofSeqNonCopying(bQ);bS=bs.length(bR);return bS===0?Q.Const():bS===1?bs.get(bR,0):(bT=by.max(by.map(function(bV){return bV.Duration;},bR)),(bU=bs.map(function(bV){return Q.Prolong(bT,bV);},bR),Q.Def(bT,function(bV){bs.iter(function(bW){bW.Compute(bV);},bU);})));};Q.Prolong=function(bQ,bR){var bS,bT,bU;bS=bR.Compute;bT=bR.Duration;bU=bJ.Create(function(){return bR.Compute(bR.Duration);});return{Compute:function(bV){return bV>=bT?bU.f():bS(bV);},Duration:bQ};};Q.Const=function(bQ){return Q.Def(0,function(){return bQ;});};Q.Def=function(bQ,bR){return{Compute:bR,Duration:bQ};};Q.Finalize=function(bQ){bs.iter(function(bR){if(bR.$==0)bR.$0();},o.ToArray(bQ.$0));};Q.List=function(bQ){return bQ.$0;};R=d.Trans=bA.Class({Copy:function(bQ,bR,bS,bT){var bU,bV,bW,bX,bY;function bZ(b0,b1){return bU.TChange(b0,b1);}bU=this;bV=bQ==null?function(b0){return function(b1){return bZ(b0,b1);};}:bQ.$0;return new R.New$3(function(b0,b1){return(bV(b0))(b1);},(bW=this.get_TEnter(),bR==null?bW:bR.$0),(bX=this.get_TExit(),bS==null?bX:bS.$0),(bY=this.get_TFlags(),bT==null?bY:bT.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bQ,bR){return this.change(bQ,bR);}},b.Obj,R);R.New=bA.Ctor(function(bQ,bR,bS){R.New$3.call(this,bQ,bB.Equals(bR,null)?P.Const:bR,bB.Equals(bS,null)?P.Const:bS,1|(bB.Equals(bR,null)?0:2)|(bB.Equals(bS,null)?0:4));},R);R.New$1=bA.Ctor(function(bQ){R.New$3.call(this,bQ,P.Const,P.Const,1);},R);R.New$2=bA.Ctor(function(){R.New$3.call(this,function(bQ,bR){return P.Const(bR);},P.Const,P.Const,0);},R);R.New$3=bA.Ctor(function(bQ,bR,bS,bT){this.change=bQ;this.enter=bR;this.exit=bS;this.flags=bT;},R);R.Exit=function(bQ,bR){return bR.Copy(null,null,{$:1,$0:bQ},{$:1,$0:bR.get_TFlags()|4});};R.Enter=function(bQ,bR){return bR.Copy(null,{$:1,$0:bQ},null,{$:1,$0:bR.get_TFlags()|2});};R.Change=function(bQ,bR){return bR.Copy({$:1,$0:bQ},null,null,{$:1,$0:bR.get_TFlags()|1});};R.Create=function(bQ){return new R.New$1(bQ);};R.Trivial=function(){return new R.New$2();};R.CanAnimateExit=function(bQ){var bR,bS;bR=bQ.get_TFlags();bS=4;return(bR&bS)===bS;};R.CanAnimateEnter=function(bQ){var bR,bS;bR=bQ.get_TFlags();bS=2;return(bR&bS)===bS;};R.CanAnimateChange=function(bQ){var bR,bS;bR=bQ.get_TFlags();bS=1;return(bR&bS)===bS;};R.AnimateExit=function(bQ,bR){return(bQ.get_TExit())(bR);};R.AnimateEnter=function(bQ,bR){return(bQ.get_TEnter())(bR);};R.AnimateChange=function(bQ,bR,bS){return bQ.TChange(bR,bS);};S.$cctor=function(){S.$cctor=a.ignore;S.CubicInOut=N.Custom(function(bQ){var bR;bR=bQ*bQ;return 3*bR-2*(bR*bQ);});S.UseAnimations=true;};T=d.AnimatedAttrNode=bA.Class({sync:function(bQ){var bR;if(this.dirty){bR=this.logical;bR==null?void 0:(this.push(bQ))(bR.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bQ,bR){this.visible={$:1,$0:bR};this.dirty=true;(this.push(bQ))(bR);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(bQ){var bR,bS;bR=this;return P.WhenDone(function(){bR.dirty=true;bR.visible=null;},(bS=this.visible,bS!=null&&bS.$==1?P.Pack(P.Map(function(bT){bR.pushVisible(bQ,bT);},R.AnimateExit(this.tr,bS.$0))):P.get_Empty()));},NGetEnterAnim:function(bQ){var bR,bS,bT,bU,bV;bR=this;return P.WhenDone(function(){bR.sync(bQ);},(bS=this.visible,(bT=this.logical,bS!=null&&bS.$==1&&(bT!=null&&bT.$==1&&(this.dirty&&(bU=[bT.$0,bS.$0],true)))?P.Pack(P.Map(function(bW){bR.pushVisible(bQ,bW);},R.AnimateChange(this.tr,bU[1],bU[0]))):bS==null&&(bT!=null&&bT.$==1&&true)?P.Pack(P.Map(function(bW){bR.pushVisible(bQ,bW);},R.AnimateEnter(this.tr,bT.$0))):P.get_Empty())));},NGetChangeAnim:function(bQ){var bR,bS,bT,bU;bR=this;return P.WhenDone(function(){bR.sync(bQ);},(bS=this.visible,(bT=this.logical,bS!=null&&bS.$==1&&(bT!=null&&bT.$==1&&(this.dirty&&(bU=[bT.$0,bS.$0],true)))?P.Pack(P.Map(function(bV){bR.pushVisible(bQ,bV);},R.AnimateChange(this.tr,bU[1],bU[0]))):P.get_Empty())));}},b.Obj,T);T.New=bA.Ctor(function(bQ,bR,bS){var bT;bT=this;this.tr=bQ;this.push=bS;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(bU){bT.logical={$:1,$0:bU};bT.dirty=true;},bR);},T);U=d.DynamicAttrNode=bA.Class({NChanged:function(){return this.updates;},NSync:function(bQ){if(this.dirty){(this.push(bQ))(this.value);this.dirty=false;}},NGetExitAnim:function(bQ){return P.get_Empty();},NGetEnterAnim:function(bQ){return P.get_Empty();},NGetChangeAnim:function(bQ){return P.get_Empty();}},b.Obj,U);U.New=bA.Ctor(function(bQ,bR){var bS;bS=this;this.push=bR;this.value=void 0;this.dirty=false;this.updates=y.Map(function(bT){bS.value=bT;bS.dirty=true;},bQ);},U);V=d.AttrProxy=bA.Class({},null,V);V.Handler=function(bQ,bR){return Z.Static(function(bS){bS.addEventListener(bQ,function(bT){return(bR(bS))(bT);},false);});};V.Concat=function(bQ){var bR;bR=e.ofSeqNonCopying(bQ);return e.TreeReduce(Z.EmptyAttr(),V.Append,bR);};V.Append=function(bQ,bR){return Z.AppendTree(bQ,bR);};V.Create=function(bQ,bR){return Z.Static(function(bS){q.SetAttr(bS,bQ,bR);});};Y.New=function(bQ,bR,bS,bT){var bU;bU={DynElem:bQ,DynFlags:bR,DynNodes:bS};bA.SetOptional(bU,"OnAfterRender",bT);return bU;};Z.Static=function(bQ){return new V({$:3,$0:bQ});};Z.Dynamic=function(bQ,bR){return new V({$:1,$0:new U.New(bQ,bR)});};Z.Animated=function(bQ,bR,bS){var bT,bU,bV;bT=new T.New(bQ,bR,bS);bU=4;R.CanAnimateEnter(bQ)?bU=bU|1:void 0;R.CanAnimateExit(bQ)?bU=bU|2:void 0;bV=new V({$:1,$0:bT});Z.SetFlags(bV,bU);return bV;};Z.EmptyAttr=function(){_2.$cctor();return _2.EmptyAttr;};Z.AppendTree=function(bQ,bR){var bS;return bQ===null?bR:bR===null?bQ:(bS=new V({$:2,$0:bQ,$1:bR}),(Z.SetFlags(bS,Z.Flags(bQ)|Z.Flags(bR)),bS));};Z.GetChangeAnim=function(bQ){return Z.GetAnim(bQ,function(bR,bS){return bR.NGetChangeAnim(bS);});};Z.GetExitAnim=function(bQ){return Z.GetAnim(bQ,function(bR,bS){return bR.NGetExitAnim(bS);});};Z.GetEnterAnim=function(bQ){return Z.GetAnim(bQ,function(bR,bS){return bR.NGetEnterAnim(bS);});};Z.GetAnim=function(bQ,bR){return P.Concat(bs.map(function(bS){return bR(bS,bQ.DynElem);},bQ.DynNodes));};Z.Updates=function(bQ){return e.MapTreeReduce(function(bR){return bR.NChanged();},y.Const(),y.Map2Unit,bQ.DynNodes);};Z.Empty=function(bQ){return Y.New(bQ,0,[],null);};Z.Insert=function(bQ,bR){var bS,bT,bU;function bV(bW){if(!(bW===null))if(bW!=null&&bW.$==1)bS.push(bW.$0);else if(bW!=null&&bW.$==2){bV(bW.$0);bV(bW.$1);}else if(bW!=null&&bW.$==3)bW.$0(bQ);else if(bW!=null&&bW.$==4)bT.push(bW.$0);}bS=[];bT=[];bV(bR);bU=bS.slice(0);return Y.New(bQ,Z.Flags(bR),bU,bT.length===0?null:{$:1,$0:function(bW){by.iter(function(bX){bX(bW);},bT);}});};Z.Sync=function(bQ,bR){bs.iter(function(bS){bS.NSync(bQ);},bR.DynNodes);};Z.SetFlags=function(bQ,bR){bQ.flags=bR;};Z.Flags=function(bQ){return bQ!==null&&bQ.hasOwnProperty("flags")?bQ.flags:0;};Z.HasExitAnim=function(bQ){var bR;bR=2;return(bQ.DynFlags&bR)===bR;};Z.HasEnterAnim=function(bQ){var bR;bR=1;return(bQ.DynFlags&bR)===bR;};Z.HasChangeAnim=function(bQ){var bR;bR=4;return(bQ.DynFlags&bR)===bR;};_0=d.CheckedInput=bA.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_0);_0.Make=function(bQ){return new _0({$:0,$0:bQ,$1:a.String(bQ)});};_1.ValidateForm=function(){return _1.OnAfterRender(function(bQ){if(window.H5F)window.H5F.setup(bQ);});};_1.Checked=function(bQ){function bR(bS,bT){return!bB.Equals(bQ.RVal(),bS.checked)?bQ.set_RVal(bS.checked):null;}return V.Concat([_1.DynamicProp("checked",bQ.RView()),_1.Handler("change",function(bS){return function(bT){return bR(bS,bT);};}),_1.Handler("click",function(bS){return function(bT){return bR(bS,bT);};})]);};_1.FloatValue=function(bQ){return _1.CustomVar(bQ,function(bR,bS){var bT;bT=bS.get_Input();return bR.value!==bT?void(bR.value=bT):null;},function(bR){var bS,bT;bS=bR.value;return{$:1,$0:f.isBlank(bS)?(bR.checkValidity?bR.checkValidity():true)?new _0({$:2,$0:bS}):new _0({$:1,$0:bS}):(bT=+bS,a.isNaN(bT)?new _0({$:1,$0:bS}):new _0({$:0,$0:bT,$1:bS}))};});};_1.FloatValueUnchecked=function(bQ){return _1.CustomValue(bQ,a.String,function(bR){var bS;return f.isBlank(bR)?{$:1,$0:0}:(bS=+bR,a.isNaN(bS)?null:{$:1,$0:bS});});};_1.IntValue=function(bQ){return _1.CustomVar(bQ,function(bR,bS){var bT;bT=bS.get_Input();return bR.value!==bT?void(bR.value=bT):null;},function(bR){var bS,bT,bU;bS=bR.value;return{$:1,$0:f.isBlank(bS)?(bR.checkValidity?bR.checkValidity():true)?new _0({$:2,$0:bS}):new _0({$:1,$0:bS}):(bT=(bU=0,[bM.TryParseInt32(bS,{get:function(){return bU;},set:function(bV){bU=bV;}}),bU]),bT[0]?new _0({$:0,$0:bT[1],$1:bS}):new _0({$:1,$0:bS}))};});};_1.IntValueUnchecked=function(bQ){return _1.CustomValue(bQ,a.String,function(bR){var bS;return f.isBlank(bR)?{$:1,$0:0}:(bS=+bR,bS!==bS>>0?null:{$:1,$0:bS});});};_1.Value=function(bQ){function bR(bS){return{$:1,$0:bS};}return _1.CustomValue(bQ,a.id,function(bS){return bR(a.id(bS));});};_1.ContentEditableHtml=function(bQ){var bR;bR=_1.CustomVar(bQ,function(bS,bT){bS.innerHTML=bT;},function(bS){return{$:1,$0:bS.innerHTML};});return V.Append(V.Create("contenteditable","true"),bR);};_1.ContentEditableText=function(bQ){var bR;bR=_1.CustomVar(bQ,function(bS,bT){bS.textContent=bT;},function(bS){return{$:1,$0:bS.textContent};});return V.Append(V.Create("contenteditable","true"),bR);};_1.CustomValue=function(bQ,bR,bS){return _1.CustomVar(bQ,function(bT,bU){bT.value=bR(bU);},function(bT){return bS(bT.value);});};_1.CustomVar=function(bQ,bR,bS){function bT(bV,bW){return bQ.RUpdM(function(bX){var bY,bZ;bY=bS(bV);return bY!=null&&bY.$==1&&(!bB.Equals(bY.$0,bX)&&(bZ=[bY,bY.$0],true))?bZ[0]:null;});}function bU(bV,bW){var bX,bY;bX=bS(bV);return bX!=null&&bX.$==1&&(bB.Equals(bX.$0,bW)&&(bY=bX.$0,true))?null:bR(bV,bW);}return V.Concat([_1.Handler("change",function(bV){return function(bW){return bT(bV,bW);};}),_1.Handler("input",function(bV){return function(bW){return bT(bV,bW);};}),_1.Handler("keypress",function(bV){return function(bW){return bT(bV,bW);};}),_1.DynamicCustom(function(bV){return function(bW){return bU(bV,bW);};},bQ.RView())]);};_1.DynamicProp=function(bQ,bR){return Z.Dynamic(bR,function(bS){return function(bT){bS[bQ]=bT;};});};_1.DynamicPred=function(bQ,bR,bS){function bT(bU,bV){return bV[0]?q.SetAttr(bU,bQ,bV[1]):q.RemoveAttr(bU,bQ);}return Z.Dynamic(y.Map2(function(bU,bV){return[bU,bV];},bR,bS),function(bU){return function(bV){return bT(bU,bV);};});};_1.DynamicClass=function(bQ,bR,bS){return Z.Dynamic(bR,function(bT){return function(bU){return bS(bU)?q.AddClass(bT,bQ):q.RemoveClass(bT,bQ);};});};_1.OnAfterRenderView=function(bQ,bR){var bS;bS=h.Id();return V.Append(_1.OnAfterRender(function(bT){bR(bT,bT[bS]);}),_1.DynamicCustom(function(bT){return function(bU){bT[bS]=bU;};},bQ));};_1.OnAfterRender=function(bQ){return new V({$:4,$0:bQ});};_1.HandlerView=function(bQ,bR,bS){return Z.Static(function(bT){var bU;bU=bS(bT);bT.addEventListener(bQ,function(bV){return y.Get(bU(bV),bR);},false);});};_1.Handler=function(bQ,bR){return Z.Static(function(bS){bS.addEventListener(bQ,function(bT){return(bR(bS))(bT);},false);});};_1.DynamicStyle=function(bQ,bR){return Z.Dynamic(bR,function(bS){return function(bT){return q.SetStyle(bS,bQ,bT);};});};_1.DynamicCustom=function(bQ,bR){return Z.Dynamic(bR,bQ);};_1.Dynamic=function(bQ,bR){return Z.Dynamic(bR,function(bS){return function(bT){return q.SetAttr(bS,bQ,bT);};});};_1.AnimatedStyle=function(bQ,bR,bS,bT){return Z.Animated(bR,bS,function(bU){return function(bV){return q.SetStyle(bU,bQ,bT(bV));};});};_1.Animated=function(bQ,bR,bS,bT){return Z.Animated(bR,bS,function(bU){return function(bV){return q.SetAttr(bU,bQ,bT(bV));};});};_1.Class=function(bQ){return Z.Static(function(bR){q.AddClass(bR,bQ);});};_1.Style=function(bQ,bR){return Z.Static(function(bS){q.SetStyle(bS,bQ,bR);});};_2.$cctor=function(){_2.$cctor=a.ignore;_2.EmptyAttr=null;};_3=d.DocElemNode=bA.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bQ){return this.ElKey===bQ.ElKey;}},null,_3);_3.New=function(bQ,bR,bS,bT,bU,bV){var bW;return new _3((bW={Attr:bQ,Children:bR,El:bT,ElKey:bU},(bA.SetOptional(bW,"Delimiters",bS),bA.SetOptional(bW,"Render",bV),bW)));};_5.FoldBack=function(bQ,bR,bS){return bs.foldBack(bQ,bR.$0,bS);};_5.Iter=function(bQ,bR){bs.iter(bQ,bR.$0);};_5.Except=function(bQ,bR){var bS;bS=bQ.$0;return{$:0,$0:bs.filter(function(bT){return bs.forall(function(bU){return!(bT===bU);},bS);},bR.$0)};};_5.DocChildren=function(bQ){var bR;function bS(bT){if(bT!=null&&bT.$==2)bS(bT.$0.Current);else if(bT!=null&&bT.$==1)bR.push(bT.$0.El);else if(bT==null);else if(bT!=null&&bT.$==5)bR.push(bT.$0);else if(bT!=null&&bT.$==4)bR.push(bT.$0.Text);else if(bT!=null&&bT.$==6)bs.iter(function(bU){if(bU.constructor===a.Object)bS(bU);else bR.push(bU);},bT.$0.Els);else{bS(bT.$0);bS(bT.$1);}}bR=[];bS(bQ.Children);return{$:0,$0:e.ofSeqNonCopying(bR)};};_5.Children=function(bQ,bR){var bS,bT,bU;if(bR!=null&&bR.$==1){bU=[];bS=bR.$0[0].nextSibling;while(bS!==bR.$0[1]){bU.push(bS);bS=bS.nextSibling;}return{$:0,$0:bU};}else return{$:0,$0:bs.init(bQ.childNodes.length,(bT=bQ.childNodes,function(bV){return bT[bV];}))};};_6.ToArray=function(bQ){return i.ToArray(bQ.$0);};_6.get_Empty=function(){return{$:0,$0:new bx.New$3()};};_6.IsEmpty=function(bQ){return bQ.$0.get_Count()===0;};_6.Intersect=function(bQ,bR){return{$:0,$0:i.Intersect(bQ.$0,bR.$0)};};_6.Except=function(bQ,bR){return{$:0,$0:i.Except(bQ.$0,bR.$0)};};_6.FindAll=function(bQ){var bR;function bS(bU){if(bU!=null&&bU.$==0){bS(bU.$0);bS(bU.$1);}else if(bU!=null&&bU.$==1)bT(bU.$0);else if(bU!=null&&bU.$==2)bS(bU.$0.Current);else if(bU!=null&&bU.$==6)bs.iter(bT,bU.$0.Holes);}function bT(bU){bR.push(bU);bS(bU.Children);}bR=[];bS(bQ);return{$:0,$0:new bx.New$2(bR)};};_6.Filter=function(bQ,bR){return{$:0,$0:i.Filter(bQ,bR.$0)};};_7.New=function(bQ,bR){return{PreviousNodes:bQ,Top:bR};};_8.TextHoleRE=function(){ba.$cctor();return ba.TextHoleRE;};_8.LoadedTemplates=function(){ba.$cctor();return ba.LoadedTemplates;};_8.UpdateTextNode=function(bQ,bR){bQ.Value=bR;bQ.Dirty=true;};_8.CreateTextNode=function(){return{Text:q.CreateText(""),Dirty:false,Value:""};};_8.UpdateEmbedNode=function(bQ,bR){bQ.Current=bR;bQ.Dirty=true;};_8.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_8.PerformAnimatedUpdate=function(bQ,bR){var bS;return P.get_UseAnimations()?(bS=null,bD.Delay(function(){var bT,bU,bV;bT=_6.FindAll(bR);bU=_8.ComputeChangeAnim(bQ,bT);bV=_8.ComputeEnterAnim(bQ,bT);return bD.Bind(P.Play(P.Append(bU,_8.ComputeExitAnim(bQ,bT))),function(){return bD.Bind(_8.SyncElemNodesNextFrame(bQ),function(){return bD.Bind(P.Play(bV),function(){bQ.PreviousNodes=bT;return bD.Return(null);});});});})):_8.SyncElemNodesNextFrame(bQ);};_8.SyncElemNodesNextFrame=function(bQ){function bR(bS){a.requestAnimationFrame(function(){_8.SyncElemNode(bQ.Top);bS();});}return bD.FromContinuations(function(bS,bT,bU){return bR.apply(null,[bS,bT,bU]);});};_8.ComputeEnterAnim=function(bQ,bR){return P.Concat(bs.map(function(bS){return Z.GetEnterAnim(bS.Attr);},_6.ToArray(_6.Except(bQ.PreviousNodes,_6.Filter(function(bS){return Z.HasEnterAnim(bS.Attr);},bR)))));};_8.ComputeChangeAnim=function(bQ,bR){var bS;function bT(bU){return Z.HasChangeAnim(bU.Attr);}bS=function(bU){return _6.Filter(bT,bU);};return P.Concat(bs.map(function(bU){return Z.GetChangeAnim(bU.Attr);},_6.ToArray(_6.Intersect(bS(bQ.PreviousNodes),bS(bR)))));};_8.ComputeExitAnim=function(bQ,bR){return P.Concat(bs.map(function(bS){return Z.GetExitAnim(bS.Attr);},_6.ToArray(_6.Except(bR,_6.Filter(function(bS){return Z.HasExitAnim(bS.Attr);},bQ.PreviousNodes)))));};_8.CreateDelimitedRunState=function(bQ,bR,bS){return _7.New(_6.get_Empty(),_8.CreateDelimitedElemNode(bQ,bR,Z.EmptyAttr(),bS));};_8.CreateRunState=function(bQ,bR){return _7.New(_6.get_Empty(),_8.CreateElemNode(bQ,Z.EmptyAttr(),bR));};_8.CreateDelimitedElemNode=function(bQ,bR,bS,bT){var bU,bV;bU=bQ.parentNode;_8.LinkPrevElement(bR,bT);bV=Z.Insert(bU,bS);return _3.New(bV,bT,{$:1,$0:[bQ,bR]},bU,h.Int(),bA.GetOptional(bV.OnAfterRender));};_8.CreateElemNode=function(bQ,bR,bS){var bT;_8.LinkElement(bQ,bS);bT=Z.Insert(bQ,bR);return _3.New(bT,bS,null,bQ,h.Int(),bA.GetOptional(bT.OnAfterRender));};_8.SyncElemNode=function(bQ){_8.SyncElement(bQ);_8.Sync(bQ.Children);_8.AfterRender(bQ);};_8.Sync=function(bQ){var bR,bS;if(bQ!=null&&bQ.$==1)_8.SyncElemNode(bQ.$0);else if(bQ!=null&&bQ.$==2)_8.Sync(bQ.$0.Current);else if(bQ==null);else if(bQ!=null&&bQ.$==5);else if(bQ!=null&&bQ.$==4){bR=bQ.$0;bR.Dirty?(bR.Text.nodeValue=bR.Value,bR.Dirty=false):void 0;}else if(bQ!=null&&bQ.$==6){bS=bQ.$0;bs.iter(function(bT){_8.SyncElemNode(bT);},bS.Holes);bs.iter(function(bT){Z.Sync(bT[0],bT[1]);},bS.Attrs);_8.AfterRender(bS);}else{_8.Sync(bQ.$0);_8.Sync(bQ.$1);}};_8.AfterRender=function(bQ){var bR;bR=bA.GetOptional(bQ.Render);bR!=null&&bR.$==1?(bR.$0(bQ.El),bA.SetOptional(bQ,"Render",null)):void 0;};_8.InsertBeforeDelim=function(bQ,bR){var bS,bT;bS=bQ.parentNode;bT=a.document.createTextNode("");bS.insertBefore(bT,bQ);_8.LinkPrevElement(bQ,bR);return bT;};_8.LinkPrevElement=function(bQ,bR){_8.InsertDoc(bQ.parentNode,bR,bQ);};_8.LinkElement=function(bQ,bR){_8.InsertDoc(bQ,bR,null);};_8.SyncElement=function(bQ){function bR(bS){function bT(bU){var bV,bW;return bU!=null&&bU.$==0?bT(bU.$0)||bT(bU.$1):bU!=null&&bU.$==2?(bV=bU.$0,bV.Dirty||bT(bV.Current)):bU!=null&&bU.$==6&&(bW=bU.$0,bW.Dirty||bs.exists(bR,bW.Holes));}return bT(bS.Children);}Z.Sync(bQ.El,bQ.Attr);bR(bQ)?_8.DoSyncElement(bQ):void 0;};_8.DoSyncElement=function(bQ){var bR,bS,bT;function bU(bV,bW){var bX,bY;return bV!=null&&bV.$==1?bV.$0.El:bV!=null&&bV.$==2?(bX=bV.$0,bX.Dirty?(bX.Dirty=false,_8.InsertDoc(bR,bX.Current,bW)):bU(bX.Current,bW)):bV==null?bW:bV!=null&&bV.$==4?bV.$0.Text:bV!=null&&bV.$==5?bV.$0:bV!=null&&bV.$==6?(bY=bV.$0,(bY.Dirty?bY.Dirty=false:void 0,bs.foldBack(function(bZ,b0){return bZ.constructor===a.Object?bU(bZ,b0):bZ;},bY.Els,bW))):bU(bV.$0,bU(bV.$1,bW));}bR=bQ.El;_5.Iter((bS=bQ.El,function(bV){q.RemoveNode(bS,bV);}),_5.Except(_5.DocChildren(bQ),_5.Children(bQ.El,bA.GetOptional(bQ.Delimiters))));bU(bQ.Children,(bT=bA.GetOptional(bQ.Delimiters),bT!=null&&bT.$==1?bT.$0[1]:null));};_8.InsertDoc=function(bQ,bR,bS){var bT;return bR!=null&&bR.$==1?_8.InsertNode(bQ,bR.$0.El,bS):bR!=null&&bR.$==2?(bT=bR.$0,(bT.Dirty=false,_8.InsertDoc(bQ,bT.Current,bS))):bR==null?bS:bR!=null&&bR.$==4?_8.InsertNode(bQ,bR.$0.Text,bS):bR!=null&&bR.$==5?_8.InsertNode(bQ,bR.$0,bS):bR!=null&&bR.$==6?bs.foldBack(function(bU,bV){return bU.constructor===a.Object?_8.InsertDoc(bQ,bU,bV):_8.InsertNode(bQ,bU,bV);},bR.$0.Els,bS):_8.InsertDoc(bQ,bR.$0,_8.InsertDoc(bQ,bR.$1,bS));};_8.InsertNode=function(bQ,bR,bS){q.InsertAt(bQ,bS,bR);return bR;};_9=d.Doc=bA.Class({ReplaceInDom:function(bQ){var bR;bR=a.document.createTextNode("");bQ.parentNode.replaceChild(bR,bQ);_9.RunBefore(bR,this);}},b.Obj,_9);_9.Append=function(bQ,bR){return _9.Mk({$:0,$0:bQ.docNode,$1:bR.docNode},y.Map2Unit(bQ.updates,bR.updates));};_9.Concat=function(bQ){var bR;bR=e.ofSeqNonCopying(bQ);return e.TreeReduce(_9.Empty(),_9.Append,bR);};_9.Empty=function(){return _9.Mk(null,y.Const());};_9.TextNode=function(bQ){return _9.Mk({$:5,$0:q.CreateText(bQ)},y.Const());};_9.Verbatim=function(bQ){var bR;return _9.Mk(e.MapTreeReduce(function(bS){return bB.Equals(bS.nodeType,bN.TEXT_NODE)?{$:5,$0:bS}:{$:1,$0:_8.CreateElemNode(bS,Z.EmptyAttr(),null)};},null,function(bS,bT){return{$:0,$0:bS,$1:bT};},(bR=bO.parseHTML(bQ),bB.Equals(bR,null)?[]:bR)),y.Const());};_9.SvgElementMixed=function(bQ,bR){var bS;bS=_9.MixedNodes(bR);return _9.SvgElement(bQ,bS[0],bS[1]);};_9.SvgElement=function(bQ,bR,bS){var bT,bU;bT=V.Concat(bR);bU=_9.Concat(bS);return _.New(q.CreateSvgElement(bQ),bT,bU);};_9.ElementMixed=function(bQ,bR){var bS;bS=_9.MixedNodes(bR);return _9.Element(bQ,bS[0],bS[1]);};_9.ConcatMixed=function(bQ){return _9.Concat(by.map(_9.ToMixedDoc,bQ));};_9.MixedNodes=function(bQ){var bR,bS,bT,bU;bR=new bG.New$2();bS=new bG.New$2();bT=bt.Get(bQ);try{while(bT.MoveNext()){bU=bT.Current();bU instanceof V?bR.Add(bU):bS.Add(_9.ToMixedDoc(bU));}}finally{if("Dispose"in bT)bT.Dispose();}return[bR,bS];};_9.ToMixedDoc=function(bQ){return bQ instanceof _9?bQ:typeof bQ=="string"?_9.TextNode(bQ):bQ instanceof a.Element?_9.Static(bQ):typeof bQ=="function"?_9.EmbedView(y.Map(_9.ToMixedDoc,bQ)):bQ instanceof w?_9.EmbedView(y.Map(_9.ToMixedDoc,bQ.v)):bB.Equals(bQ,null)?_9.Empty():_9.TextNode(a.String(bQ));};_9.Element=function(bQ,bR,bS){var bT,bU;bT=V.Concat(bR);bU=_9.Concat(bS);return _.New(q.CreateElement(bQ),bT,bU);};_9.Radio=function(bQ,bR,bS){var bT,bU;bT=q.CreateElement("input");bT.addEventListener("click",function(){return bS.RSet(bR);},false);bU=_1.DynamicProp("checked",y.Map(function(bV){return bB.Equals(bV,bR);},bS.RView()));return _.New(bT,V.Concat(br.append(br.ofArray([V.Create("type","radio"),V.Create("name",bS.RId()),bU]),br.ofSeq(bQ))),_9.Empty());};_9.LinkView=function(bQ,bR,bS,bT){var bU;bU=V.Concat(by.append([_1.HandlerView("click",bS,function(){return function(){return bT;};}),V.Create("href","#")],bR));return _.New(q.CreateElement("a"),bU,_9.TextNode(bQ));};_9.Link=function(bQ,bR,bS){var bT,bU;bT=(bU=V.Concat(bR),V.Append(V.Create("href","#"),bU));return _.New(_9.Clickable("a",bS),bT,_9.TextNode(bQ));};_9.ButtonView=function(bQ,bR,bS,bT){var bU;bU=V.Concat(by.append([_1.HandlerView("click",bS,function(){return function(){return bT;};})],bR));return _.New(q.CreateElement("button"),bU,_9.TextNode(bQ));};_9.Button=function(bQ,bR,bS){var bT;bT=V.Concat(bR);return _.New(_9.Clickable("button",bS),bT,_9.TextNode(bQ));};_9.Clickable=function(bQ,bR){var bS;bS=q.CreateElement(bQ);bS.addEventListener("click",function(bT){bT.preventDefault();return bR();},false);return bS;};_9.CheckBoxGroup=function(bQ,bR,bS){function bT(bU){return bB.Equals(bR,bU);}return _9.CheckBox(bQ,w.Lens(bS,function(bU){return br.exists(bT,bU);},function(bU,bV){return bV?br.exists(function(bW){return bB.Equals(bR,bW);},bU)?bU:new br.T({$:1,$0:bR,$1:bU}):br.filter(function(bW){return!bB.Equals(bR,bW);},bU);}));};_9.CheckBox=function(bQ,bR){return _9.InputInternal("input",function(){return by.append(bQ,[V.Create("type","checkbox"),_1.Checked(bR)]);});};_9.SelectDynOptional=function(bQ,bR,bS,bT,bU){return _9.SelectDyn(bQ,function(bV){return bV!=null&&bV.$==1?bS(bV.$0):bR;},y.Map(function(bV){return new br.T({$:1,$0:null,$1:br.map(function(bW){return{$:1,$0:bW};},bV)});},bT),bU);};_9.SelectOptional=function(bQ,bR,bS,bT,bU){return _9.Select(bQ,function(bV){return bV!=null&&bV.$==1?bS(bV.$0):bR;},new br.T({$:1,$0:null,$1:br.map(function(bV){return{$:1,$0:bV};},bT)}),bU);};_9.Select=function(bQ,bR,bS,bT){return _9.SelectImpl(bQ,bR,function(bU){bU[0]=bS;return _9.Concat(br.mapi(function(bV,bW){return _9.Element("option",br.ofArray([V.Create("value",a.String(bV))]),br.ofArray([_9.TextNode(bR(bW))]));},bS));},bT);};_9.SelectDyn=function(bQ,bR,bS,bT){return _9.SelectImpl(bQ,bR,function(bU){function bV(bW,bX){return _9.Element("option",br.ofArray([V.Create("value",a.String(bW))]),br.ofArray([_9.TextNode(bR(bX))]));}return _9.Convert(function(bW){return bV(bW[0],bW[1]);},y.Map(function(bW){bU[0]=bW;return by.mapi(function(bX,bY){return[bX,bY];},bW);},bS));},bT);};_9.SelectImpl=function(bQ,bR,bS,bT){var bU,bV,bW,bX;function bY(b3){return b3.selectedIndex;}function bZ(b3,b4){b3.selectedIndex=b4;}function b0(b3){var b4;b4=bY(b3);return bU[0].get_Item(b4);}function b1(b3){return by.findIndex(function(b4){return bB.Equals(b3,b4);},bU[0]);}function b2(b3,b4){return bZ(b3,b1(b4));}bU=[br.T.Empty];bV=q.CreateElement("select");bW=_1.DynamicCustom(function(b3){return function(b4){return b2(b3,b4);};},bT.RView());bV.addEventListener("change",function(){bT.RUpdM(function(b3){var b4;b4=b0(bV);return bB.Equals(b3,b4)?null:{$:1,$0:b4};});},false);return _.New(bV,(bX=V.Append(bW,V.Concat(bQ)),V.Append(_1.OnAfterRender(function(b3){b2(b3,bT.RGet());}),bX)),bS(bU));};_9.InputArea=function(bQ,bR){return _9.InputInternal("textarea",function(){return by.append(bQ,[_1.Value(bR)]);});};_9.FloatInput=function(bQ,bR){return _9.InputInternal("input",function(){return by.append(bQ,[_1.FloatValue(bR),V.Create("type","number")]);});};_9.FloatInputUnchecked=function(bQ,bR){return _9.InputInternal("input",function(){return by.append(bQ,[bR.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.FloatValueUnchecked(bR),V.Create("type","number")]);});};_9.IntInput=function(bQ,bR){return _9.InputInternal("input",function(){return by.append(bQ,[_1.IntValue(bR),V.Create("type","number")]);});};_9.IntInputUnchecked=function(bQ,bR){return _9.InputInternal("input",function(){return by.append(bQ,[bR.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.IntValueUnchecked(bR),V.Create("type","number")]);});};_9.PasswordBox=function(bQ,bR){return _9.InputInternal("input",function(){return by.append(bQ,[_1.Value(bR),V.Create("type","password")]);});};_9.Input=function(bQ,bR){return _9.InputInternal("input",function(){return by.append(bQ,[_1.Value(bR)]);});};_9.InputInternal=function(bQ,bR){var bS;bS=q.CreateElement(bQ);return _.New(bS,V.Concat(bR(bS)),_9.Empty());};_9.ConvertSeqBy=function(bQ,bR,bS){return _9.Flatten(y.MapSeqCachedViewBy(bQ,function(bT,bU){return(bR(bT))(bU);},bS));};_9.ConvertSeq=function(bQ,bR){return _9.Flatten(y.MapSeqCachedView(bQ,bR));};_9.ConvertBy=function(bQ,bR,bS){return _9.Flatten(y.MapSeqCachedBy(bQ,bR,bS));};_9.Convert=function(bQ,bR){return _9.Flatten(y.MapSeqCached(bQ,bR));};_9.Flatten=function(bQ){return _9.EmbedView(y.Map(_9.Concat,bQ));};_9.GetOrLoadTemplate=function(bQ,bR,bS,bT){_9.PrepareTemplate(bQ,bR,bS);return _9.NamedTemplate(bQ,bR,bT);};_9.NamedTemplate=function(bQ,bR,bS){var bT,bU,bV;bT=_9.ComposeName(bQ,bR);bU=(bV=null,[_8.LoadedTemplates().TryGetValue(bT,{get:function(){return bV;},set:function(bW){bV=bW;}}),bV]);return bU[0]?_9.ChildrenTemplate(bU[1].cloneNode(true),bS):(bC.warn("Local template doesn't exist",bT),_9.Empty());};_9.LoadLocalTemplates=function(bQ){(function(){var bR,bS,bT,bU;while(true){bR=a.document.querySelector("[ws-template]");if(bB.Equals(bR,null)){bS=a.document.querySelector("[ws-children-template]");if(bB.Equals(bS,null))return null;else{bT=bS.getAttribute("ws-children-template");bS.removeAttribute("ws-children-template");_9.PrepareTemplate(bQ,{$:1,$0:bT},function(bV){return function(){return q.ChildrenArray(bV);};}(bS));}}else{bU=bR.getAttribute("ws-template");_9.PrepareSingleTemplate(bQ,{$:1,$0:bU},bR);}}}());};_9.PrepareTemplate=function(bQ,bR,bS){var bT,bU,bV,bW,bX;if(!_8.LoadedTemplates().ContainsKey(_9.ComposeName(bQ,bR))){bT=bS();for(bU=0,bV=bT.length-1;bU<=bV;bU++){bW=bs.get(bT,bU);bX=bW.parentNode;bB.Equals(bX,null)?void 0:bX.removeChild(bW);}_9.PrepareTemplateStrict(bQ,bR,bT);}};_9.PrepareTemplateStrict=function(bQ,bR,bS){var bT;function bU(b6){var b8,b9,b_,b$,ca,cb,cc,cd;function b7(ce){var cf;cf=b6.getAttribute(ce);cf===null?void 0:b6.setAttribute(ce,cf.toLowerCase());}b8=b6.attributes;b9=[];b_=[];b$=[];for(ca=0,cb=b8.length-1;ca<=cb;ca++){cc=b8.item(ca);bu.StartsWith(cc.nodeName,"ws-on")&&cc.nodeName!=="ws-onafterrender"&&cc.nodeName!=="ws-on"?(b9.push(cc.nodeName),b_.push(bP.string(cc.nodeName,{$:1,$0:"ws-on".length},null)+":"+cc.nodeValue.toLowerCase())):!bu.StartsWith(cc.nodeName,"ws-")&&(new a.RegExp(_8.TextHoleRE())).test(cc.nodeValue)?(cc.nodeValue=(cd=new a.RegExp(_8.TextHoleRE(),"g"),cc.nodeValue.replace(cd,function(ce,cf){return"${"+cf.toLowerCase()+"}";})),b$.push(cc.nodeName)):void 0;}!(b_.length==0)?b6.setAttribute("ws-on",bu.concat(" ",b_)):void 0;!(b$.length==0)?b6.setAttribute("ws-attr-holes",bu.concat(" ",b$)):void 0;b7("ws-hole");b7("ws-replace");b7("ws-attr");b7("ws-onafterrender");b7("ws-var");bs.iter(function(ce){b6.removeAttribute(ce);},b9);}function bV(b6){var b7,b8,b9,b_,b$,ca;b7=null;b8=0;b_=b6.textContent;b$=new a.RegExp(_8.TextHoleRE(),"g");while(b7=b$.exec(b_),b7!==null){b6.parentNode.insertBefore(a.document.createTextNode(bP.string(b_,{$:1,$0:b8},{$:1,$0:b$.lastIndex-bs.get(b7,0).length-1})),b6);b8=b$.lastIndex;ca=a.document.createElement("span");ca.setAttribute("ws-replace",bs.get(b7,1).toLowerCase());b6.parentNode.insertBefore(ca,b6);}b$.lastIndex=0;b6.textContent=bP.string(b_,{$:1,$0:b8},null);}function bW(b6,b7){function b8(b9){q.IterSelector(b6,"["+b9+"]",function(b_){var b$,ca;b$=(ca=null,[b7.TryGetValue(b_.getAttribute(b9).toLowerCase(),{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);b$[0]?b_.setAttribute(b9,b$[1]):void 0;});}b8("ws-hole");b8("ws-replace");b8("ws-attr");b8("ws-onafterrender");b8("ws-var");q.IterSelector(b6,"[ws-on]",function(b9){b9.setAttribute("ws-on",bu.concat(" ",bs.map(function(b_){var b$,ca,cb;b$=bu.SplitChars(b_,[":"],1);ca=(cb=null,[b7.TryGetValue(bs.get(b$,1),{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);return ca[0]?bs.get(b$,0)+":"+ca[1]:b_;},bu.SplitChars(b9.getAttribute("ws-on"),[" "],1))));});return q.IterSelector(b6,"[ws-attr-holes]",function(b9){var b_,b$,ca;b_=bu.SplitChars(b9.getAttribute("ws-attr-holes"),[" "],1);for(b$=0,ca=b_.length-1;b$<=ca;b$++)(function(){var cb;function cc(cd,ce){var cf;cf=bH.KeyValue(ce);return cd.replace(new a.RegExp("\\${"+cf[0]+"}","ig"),"${"+cf[1]+"}");}cb=bs.get(b_,b$);return b9.setAttribute(cb,(((bA.Curried3(by.fold))(cc))(b9.getAttribute(cb)))(b7));}());});}function bX(b6,b7){var b8,b9,b_,b$,ca;bU(b7);b8=b7.nodeName.toLowerCase();b9=b6.querySelector("[ws-attr="+b8+"]");if(bB.Equals(b9,null))return bC.warn("Filling non-existent attr hole",b8);else{b9.removeAttribute("ws-attr");for(b_=0,b$=b7.attributes.length-1;b_<=b$;b_++){ca=b7.attributes.item(b_);ca.name==="class"&&b9.hasAttribute("class")?b9.setAttribute("class",b9.getAttribute("class")+" "+ca.nodeValue):b9.setAttribute(ca.name,ca.nodeValue);}return;}}function bY(b6,b7){function b8(b9){q.IterSelector(b6,"["+b9+"]",function(b_){if(!b7.Contains(b_.getAttribute(b9)))b_.removeAttribute(b9);});}b8("ws-attr");b8("ws-onafterrender");b8("ws-var");q.IterSelector(b6,"[ws-hole]",function(b9){if(!b7.Contains(b9.getAttribute("ws-hole"))){b9.removeAttribute("ws-hole");while(b9.hasChildNodes())b9.removeChild(b9.lastChild);}});q.IterSelector(b6,"[ws-replace]",function(b9){if(!b7.Contains(b9.getAttribute("ws-replace")))b9.parentNode.removeChild(b9);});q.IterSelector(b6,"[ws-on]",function(b9){b9.setAttribute("ws-on",bu.concat(" ",bs.filter(function(b_){return b7.Contains(bs.get(bu.SplitChars(b_,[":"],1),1));},bu.SplitChars(b9.getAttribute("ws-on"),[" "],1))));});return q.IterSelector(b6,"[ws-attr-holes]",function(b9){var b_,b$,ca,cb,cc;b_=bu.SplitChars(b9.getAttribute("ws-attr-holes"),[" "],1);for(b$=0,ca=b_.length-1;b$<=ca;b$++){cb=bs.get(b_,b$);b9.setAttribute(cb,(cc=new a.RegExp(_8.TextHoleRE(),"g"),b9.getAttribute(cb).replace(cc,function(cd,ce){return b7.Contains(ce)?cd:"";})));}});}function bZ(b6,b7){var b8;b8=b6.querySelector("[ws-replace]");return bB.Equals(b8,null)?(bC.warn("Filling non-existent text hole",bR),null):(b8.parentNode.replaceChild(new a.Text(b7),b8),{$:1,$0:b8.getAttribute("ws-replace")});}function b0(b6,b7,b8){while(true)if(b6.hasChildNodes())b8=b7.insertBefore(b6.lastChild,b8);else return null;}function b1(b6,b7,b8){var b9,b_,b$,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct;while(true)switch(b6){case 0:function ca(cu){}cb=bP.string(b7.nodeName,{$:1,$0:3},null).toLowerCase();cc=cb.indexOf(".")===-1?bQ+"/"+cb:bu.Replace(cb,".","/");if(!_8.LoadedTemplates().ContainsKey(cc))return bC.warn("Instantiating non-loaded template",cc);else{cd=_8.LoadedTemplates().get_Item(cc);ce=cd.cloneNode(true);cf=new bx.New$3();cg=new bK.New$5();ch=b7.attributes;for(ci=0,cj=ch.length-1;ci<=cj;ci++){ck=ch.item(ci).name.toLowerCase();cg.set_Item(ck,(cl=ch.item(ci).nodeValue,cl===""?ck:cl.toLowerCase()));!cf.Add(ck)?bC.warn("Hole mapped twice",ck):void 0;}for(cm=0,cn=b7.childNodes.length-1;cm<=cn;cm++){co=b7.childNodes[cm];bB.Equals(co.nodeType,bN.ELEMENT_NODE)?!cf.Add(co.nodeName.toLowerCase())?bC.warn("Hole filled twice",cc):void 0:void 0;}cp=b7.childNodes.length===1&&bB.Equals(b7.firstChild.nodeType,bN.TEXT_NODE);if(cp){b_=bZ(ce,b7.firstChild.textContent);((function(cu){return function(cv){if(cv!=null)cu(cv.$0);};}((b$=function(cu){return function(cv){return cu.Add(cv);};}(cf),function(cu){return ca(b$(cu));})))(b_));}bY(ce,cf);if(!cp){for(cq=0,cr=b7.childNodes.length-1;cq<=cr;cq++){cs=b7.childNodes[cq];bB.Equals(cs.nodeType,bN.ELEMENT_NODE)?cs.hasAttributes()?bX(ce,cs):b2(ce,cs):void 0;}}bW(ce,cg);(((function(cu){function cv(cw,cx){return b0(cu,cw,cx);}return function(cw){return function(cx){return cv(cw,cx);};};}(ce))(b7.parentNode))(b7));{b7.parentNode.removeChild(b7);return;}}break;case 1:if(b8!==null){ct=b8.nextSibling;if(bB.Equals(b8.nodeType,bN.TEXT_NODE))bV(b8);else if(bB.Equals(b8.nodeType,bN.ELEMENT_NODE))b4(b8);b8=ct;}else return null;break;}}function b2(b6,b7){var b8,b_,b$;function b9(ca,cb){var cc,cd,ce;if(b_==="title"&&b7.hasChildNodes()){cc=bO.parseHTML(b7.textContent);b7.removeChild(b7.firstChild);for(cd=0,ce=cc.length-1;cd<=ce;cd++)b7.appendChild(bs.get(cc,cd));}else null;b4(b7);return b0(b7,ca,cb);}b_=b7.nodeName.toLowerCase();q.IterSelector(b6,"[ws-attr-holes]",function(ca){var cb,cc,cd,ce,cf;cb=bu.SplitChars(ca.getAttribute("ws-attr-holes"),[" "],1);for(cc=0,cd=cb.length-1;cc<=cd;cc++){ce=bs.get(cb,cc);ca.setAttribute(ce,(cf=new a.RegExp("\\${"+b_+"}","ig"),ca.getAttribute(ce).replace(cf,b7.textContent)));}});b$=b6.querySelector("[ws-hole="+b_+"]");if(bB.Equals(b$,null)){b8=b6.querySelector("[ws-replace="+b_+"]");return bB.Equals(b8,null)?null:(b9(b8.parentNode,b8),void b8.parentNode.removeChild(b8));}else{while(b$.hasChildNodes())b$.removeChild(b$.lastChild);b$.removeAttribute("ws-hole");return b9(b$,null);}}function b3(b6){return b1(0,b6);}function b4(b6){var b7,b8;if(bu.StartsWith(b6.nodeName.toLowerCase(),"ws-")&&!b6.hasAttribute("ws-template"))b3(b6);else{bU(b6);b7=b6.getAttribute("ws-template");if(b7===null){b8=b6.getAttribute("ws-children-template");if(b8===null)b5(b6,b6.firstChild);else{b6.removeAttribute("ws-children-template");_9.PrepareTemplate(bQ,{$:1,$0:b8},function(){return q.ChildrenArray(b6);});while(b6.hasChildNodes())b6.removeChild(b6.lastChild);}}else _9.PrepareSingleTemplate(bQ,{$:1,$0:b7},b6);}}function b5(b6,b7){return b1(1,b6,b7);}bT=_9.FakeRoot(bS);_8.LoadedTemplates().set_Item(_9.ComposeName(bQ,bR),bT);bs.length(bS)>0?b5(bT,bs.get(bS,0)):void 0;};_9.ComposeName=function(bQ,bR){return(bQ+"/"+(bR==null?"":bR.$0)).toLowerCase();};_9.PrepareSingleTemplate=function(bQ,bR,bS){var bT,bU,bV;bS.removeAttribute("ws-template");bT=bS.getAttribute("ws-replace");bT===null?void 0:(bS.removeAttribute("ws-replace"),bU=bS.parentNode,bB.Equals(bU,null)?void 0:(bV=a.document.createElement(bS.tagName),bV.setAttribute("ws-replace",bT),bU.replaceChild(bV,bS)));_9.PrepareTemplateStrict(bQ,bR,[bS]);};_9.FakeRoot=function(bQ){var bR,bS,bT;bR=a.document.createElement("div");for(bS=0,bT=bQ.length-1;bS<=bT;bS++)bR.appendChild(bs.get(bQ,bS));return bR;};_9.ChildrenTemplate=function(bQ,bR){var bS,bT,bU,bV,bW,bZ,b0,b1,b2,b3,b4,b5;function bX(b6,b7){var b8,b9,b_;b8=Z.Insert(b6,b7);b0.push(Z.Updates(b8));b1.push([b6,b8]);b9=bA.GetOptional(b8.OnAfterRender);return b9==null?null:(b_=b9.$0,void b2.push(function(){b_(b6);}));}function bY(b6){var b7,b8;b7=(b8=null,[b3.TryGetValue(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);return b7[0]?b7[1].$==0?{$:1,$0:b7[1].$1}:b7[1].$==1?{$:1,$0:_9.TextNode(b7[1].$1)}:b7[1].$==2?{$:1,$0:_9.TextView(b7[1].$1)}:b7[1].$==6?{$:1,$0:_9.TextView(b7[1].$1.RView())}:b7[1].$==7?{$:1,$0:_9.TextView(y.Map(a.String,b7[1].$1.RView()))}:b7[1].$==8?{$:1,$0:_9.TextView(y.Map(function(b9){return b9.get_Input();},b7[1].$1.RView()))}:b7[1].$==9?{$:1,$0:_9.TextView(y.Map(a.String,b7[1].$1.RView()))}:b7[1].$==10?{$:1,$0:_9.TextView(y.Map(function(b9){return b9.get_Input();},b7[1].$1.RView()))}:b7[1].$==11?{$:1,$0:_9.TextView(y.Map(a.String,b7[1].$1.RView()))}:(bC.warn("Content hole filled with attribute data",b6),null):null;}bZ=[];b0=[];b1=[];b2=[];b3=new bK.New$5();b4=bt.Get(bR);try{while(b4.MoveNext()){b5=b4.Current();b3.set_Item(b5.$0,b5);}}finally{if("Dispose"in b4)b4.Dispose();}bS=q.ChildrenArray(bQ);q.IterSelector(bQ,"[ws-hole]",function(b6){var b7,b8,b9;b9=b6.getAttribute("ws-hole");b6.removeAttribute("ws-hole");while(b6.hasChildNodes())b6.removeChild(b6.lastChild);b7=bY(b9);b7!=null&&b7.$==1?(b8=b7.$0,_8.LinkElement(b6,b8.docNode),bZ.push(_3.New(Z.Empty(b6),b8.docNode,null,b6,h.Int(),null)),b0.push(b8.updates)):void 0;});q.IterSelector(bQ,"[ws-replace]",function(b6){var b7,b8,b9,b_,b$,ca;b7=bY(b6.getAttribute("ws-replace"));b7!=null&&b7.$==1?(b8=b7.$0,b9=b6.parentNode,b_=a.document.createTextNode(""),b9.replaceChild(b_,b6),b$=_8.InsertBeforeDelim(b_,b8.docNode),ca=bs.tryFindIndex(function(cb){return b6===cb;},bS),ca==null?void 0:bs.set(bS,ca.$0,b8.docNode),bZ.push(_3.New(Z.Empty(b9),b8.docNode,{$:1,$0:[b$,b_]},b9,h.Int(),null)),b0.push(b8.updates)):void 0;});q.IterSelector(bQ,"[ws-attr]",function(b6){var b7,b8,b9;b7=b6.getAttribute("ws-attr");b6.removeAttribute("ws-attr");b8=(b9=null,[b3.TryGetValue(b7,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);b8[0]?b8[1].$==3?bX(b6,b8[1].$1):bC.warn("Attribute hole filled with non-attribute data",b7):void 0;});q.IterSelector(bQ,"[ws-on]",function(b6){bX(b6,V.Concat(bs.choose(function(b7){var b8,b9,b_;b8=bu.SplitChars(b7,[":"],1);b9=(b_=null,[b3.TryGetValue(bs.get(b8,1),{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);return b9[0]?b9[1].$==4?{$:1,$0:_1.Handler(bs.get(b8,0),b9[1].$1)}:(bC.warn("Event hole on"+bs.get(b8,0)+" filled with non-event data",bs.get(b8,1)),null):null;},bu.SplitChars(b6.getAttribute("ws-on"),[" "],1))));b6.removeAttribute("ws-on");});q.IterSelector(bQ,"[ws-onafterrender]",function(b6){var b7,b8,b9;b7=b6.getAttribute("ws-onafterrender");b8=(b9=null,[b3.TryGetValue(b7,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);b8[0]?b8[1].$==5?(b6.removeAttribute("ws-onafterrender"),bX(b6,_1.OnAfterRender(b8[1].$1))):bC.warn("onafterrender hole filled with non-onafterrender data",b7):void 0;});q.IterSelector(bQ,"[ws-var]",function(b6){var b7,b8,b9;b7=b6.getAttribute("ws-var");b6.removeAttribute("ws-var");b8=(b9=null,[b3.TryGetValue(b7,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);b8[0]?b8[1].$==6?bX(b6,_1.Value(b8[1].$1)):b8[1].$==7?bX(b6,_1.Checked(b8[1].$1)):b8[1].$==8?bX(b6,_1.IntValue(b8[1].$1)):b8[1].$==9?bX(b6,_1.IntValueUnchecked(b8[1].$1)):b8[1].$==10?bX(b6,_1.FloatValue(b8[1].$1)):b8[1].$==11?bX(b6,_1.FloatValueUnchecked(b8[1].$1)):bC.warn("Var hole filled with non-Var data",b7):void 0;});q.IterSelector(bQ,"[ws-attr-holes]",function(b6){var b7,b8,b9,b_;b7=new a.RegExp(_8.TextHoleRE(),"g");b8=bu.SplitChars(b6.getAttribute("ws-attr-holes"),[" "],1);b6.removeAttribute("ws-attr-holes");for(b9=0,b_=b8.length-1;b9<=b_;b9++)(function(){var b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl;ci=bs.get(b8,b9);cj=b6.getAttribute(ci);b$=null;ca=0;ck=[];while(b$=b7.exec(cj),b$!==null){cl=bP.string(cj,{$:1,$0:ca},{$:1,$0:b7.lastIndex-bs.get(b$,0).length-1});ca=b7.lastIndex;ck.push([cl,bs.get(b$,1)]);}cc=bP.string(cj,{$:1,$0:ca},null);b7.lastIndex=0;cd=bs.foldBack(function(cm,cn){return(function(co){var cp,cq;cp=co[0];cq=co[1];return function(cr){var cs,ct,cu,cv,cw;cs=cr[0];ct=cr[1];cu=(cv=(cw=null,[b3.TryGetValue(cq,{get:function(){return cw;},set:function(cx){cw=cx;}}),cw]),cv[0]?cv[1].$==1?{$:0,$0:cv[1].$1}:cv[1].$==2?{$:1,$0:cv[1].$1}:cv[1].$==6?{$:1,$0:cv[1].$1.RView()}:cv[1].$==7?{$:1,$0:y.Map(a.String,cv[1].$1.RView())}:cv[1].$==8?{$:1,$0:y.Map(function(cx){return cx.get_Input();},cv[1].$1.RView())}:cv[1].$==9?{$:1,$0:y.Map(a.String,cv[1].$1.RView())}:cv[1].$==10?{$:1,$0:y.Map(function(cx){return cx.get_Input();},cv[1].$1.RView())}:cv[1].$==11?{$:1,$0:y.Map(a.String,cv[1].$1.RView())}:(bC.warn("Attribute value hole filled with non-text data",cq),{$:0,$0:""}):{$:0,$0:""});return cu.$==1?[cp,new br.T({$:1,$0:cs===""?cu.$0:y.Map(function(cx){return cx+cs;},cu.$0),$1:ct})]:[cp+cu.$0+cs,ct];};}(cm))(cn);},ck,[cc,br.T.Empty]);return bX(b6,cd[1].$==1?cd[1].$1.$==1?cd[1].$1.$1.$==1?cd[1].$1.$1.$1.$==0?(ce=cd[0],_1.Dynamic(ci,y.Map3(function(cm,cn,co){return ce+cm+cn+co;},cd[1].$0,cd[1].$1.$0,cd[1].$1.$1.$0))):(cf=cd[0],_1.Dynamic(ci,y.Map(function(cm){return cf+bu.concat("",cm);},y.Sequence(cd[1])))):(cg=cd[0],_1.Dynamic(ci,y.Map2(function(cm,cn){return cg+cm+cn;},cd[1].$0,cd[1].$1.$0))):cd[0]===""?_1.Dynamic(ci,cd[1].$0):(ch=cd[0],_1.Dynamic(ci,y.Map(function(cm){return ch+cm;},cd[1].$0))):V.Create(ci,cd[0]));}());});bT=bA.DeleteEmptyFields({Els:bS,Dirty:true,Holes:bZ,Attrs:b1,Render:(bU=b2.length==0?null:{$:1,$0:function(b6){bs.iter(function(b7){b7(b6);},b2);}},bU?bU.$0:void 0)},["Render"]);bV=e.TreeReduce(y.Const(),y.Map2Unit,b0);return bS&&bs.length(bS)===1&&(bs.get(bS,0)instanceof bN&&(bB.Equals(bs.get(bS,0).nodeType,bN.ELEMENT_NODE)&&(bW=bs.get(bS,0),true)))?_.TreeNode(bT,bV):_9.Mk({$:6,$0:bT},bV);};_9.Template=function(bQ,bR){return _9.ChildrenTemplate(_9.FakeRoot(bQ),bR);};_9.TextView=function(bQ){var bR;bR=_8.CreateTextNode();return _9.Mk({$:4,$0:bR},y.Map(function(bS){_8.UpdateTextNode(bR,bS);},bQ));};_9.RunReplaceById=function(bQ,bR){var bS;bS=q.Doc().getElementById(bQ);bB.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):bR.ReplaceInDom(bS);};_9.RunById=function(bQ,bR){var bS;bS=q.Doc().getElementById(bQ);bB.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_9.Run(bS,bR);};_9.Run=function(bQ,bR){var bS;bS=bR.docNode;_8.LinkElement(bQ,bS);y.Sink(m.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateRunState(bQ,bS),bS)),bR.updates);};_9.RunPrependById=function(bQ,bR){var bS;bS=q.Doc().getElementById(bQ);bB.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_9.RunPrepend(bS,bR);};_9.RunPrepend=function(bQ,bR){var bS;bS=a.document.createTextNode("");bQ.insertBefore(bS,bQ.firstChild);_9.RunBefore(bS,bR);};_9.RunAppendById=function(bQ,bR){var bS;bS=q.Doc().getElementById(bQ);bB.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_9.RunAppend(bS,bR);};_9.RunAppend=function(bQ,bR){var bS;bS=a.document.createTextNode("");bQ.appendChild(bS);_9.RunBefore(bS,bR);};_9.RunAfterById=function(bQ,bR){var bS;bS=q.Doc().getElementById(bQ);bB.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_9.RunAfter(bS,bR);};_9.RunAfter=function(bQ,bR){var bS;bS=a.document.createTextNode("");bQ.parentNode.insertBefore(bS,bQ.nextSibling);_9.RunBetween(bQ,bS,bR);};_9.RunBeforeById=function(bQ,bR){var bS;bS=q.Doc().getElementById(bQ);bB.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_9.RunBefore(bS,bR);};_9.RunBefore=function(bQ,bR){var bS;bS=a.document.createTextNode("");bQ.parentNode.insertBefore(bS,bQ);_9.RunBetween(bS,bQ,bR);};_9.RunBetween=function(bQ,bR,bS){_8.LinkPrevElement(bR,bS.docNode);y.Sink(m.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateDelimitedRunState(bQ,bR,bS.docNode),bS.docNode)),bS.updates);};_9.Async=function(bQ){return _9.EmbedView(y.MapAsync(a.id,y.Const(bQ)));};_9.BindView=function(bQ,bR){return _9.EmbedView(y.Map(bQ,bR));};_9.EmbedView=function(bQ){var bR;bR=_8.CreateEmbedNode();return _9.Mk({$:2,$0:bR},y.Map(a.ignore,y.Bind(function(bS){_8.UpdateEmbedNode(bR,bS.docNode);return bS.updates;},bQ)));};_9.Static=function(bQ){return _.New(bQ,Z.EmptyAttr(),_9.Empty());};_9.Mk=function(bQ,bR){return new _9.New(bQ,bR);};_9.New=bA.Ctor(function(bQ,bR){this.docNode=bQ;this.updates=bR;},_9);_=d.Elt=bA.Class({AddClass:function(bQ){return this.elt.className+=" "+bQ;},ClearHoles:function(){var bQ;bQ=this.docNode$1;bQ!=null&&bQ.$==6?bQ.$0.Holes=[]:void 0;},AddHole:function(bQ){var bR;bR=this.docNode$1;bR!=null&&bR.$==6?bR.$0.Holes.push(bQ):void 0;},SetStyle:function(bQ,bR){this.elt.style[bQ]=bR;},HasClass:function(bQ){return(new a.RegExp("(\\s|^)"+bQ+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bQ){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bQ+")+(\\s|$)","g"),"$1");},GetProperty:function(bQ){return this.elt[bQ];},SetProperty:function(bQ,bR){this.elt[bQ]=bR;},RemoveAttribute:function(bQ){this.elt.removeAttribute(bQ);},HasAttribute:function(bQ){return this.elt.hasAttribute(bQ);},GetAttribute:function(bQ){return this.elt.getAttribute(bQ);},SetAttribute:function(bQ,bR){this.elt.setAttribute(bQ,bR);},SetText:function(bQ){var bR;bR=this.docNode$1;bR!=null&&bR.$==1?bR.$0.Children=null:bR!=null&&bR.$==6?(bR.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=bQ;},GetText:function(){return this.elt.textContent;},SetValue:function(bQ){this.elt.value=bQ;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bQ;bQ=this.docNode$1;bQ!=null&&bQ.$==1?bQ.$0.Children=null:bQ!=null&&bQ.$==6?(bQ.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bQ){var bR,bS,bT,bU,bV;bR=this.docNode$1;bR!=null&&bR.$==1?(bS=bR.$0,bS.Children={$:0,$0:bQ.docNode,$1:bS.Children},_8.InsertDoc(this.elt,bQ.docNode,(bT=this.elt.firstChild,bB.Equals(bT,null)?null:bT))):bR!=null&&bR.$==6?(bU=this.elt.insertBefore(a.document.createTextNode(""),this.elt.firstChild),bV=_8.InsertBeforeDelim(bU,bQ.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bQ.docNode,{$:1,$0:[bV,bU]},this.elt,h.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bQ.updates));},Append:function(bQ){var bR,bS,bT,bU;bR=this.docNode$1;bR!=null&&bR.$==1?(bS=bR.$0,bS.Children={$:0,$0:bS.Children,$1:bQ.docNode},_8.InsertDoc(this.elt,bQ.docNode,null)):bR!=null&&bR.$==6?(bT=this.elt.appendChild(a.document.createTextNode("")),bU=_8.InsertBeforeDelim(bT,bQ.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bQ.docNode,{$:1,$0:[bU,bT]},this.elt,h.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bQ.updates));},ToUpdater:function(){var bQ,bR;return new $.New((bQ=this.docNode$1,bQ!=null&&bQ.$==1?bA.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bQ.$0.Attr]],Render:(bR=null,bR?bR.$0:void 0)},["Render"]):bQ!=null&&bQ.$==6?bQ.$0:bH.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,w.Create$1([]));},OnAfterRenderView:function(bQ,bR){var bS,bT;bS=this;bT=h.Id();this.Append(_9.BindView(function(bU){bS.elt[bT]=bU;return _9.Empty();},bQ));return this.OnAfterRender(function(bU){bR(bU,bU[bT]);});},OnAfterRender:function(bQ){var bR,bS,bT,bU,bV,bW,bX;bR=this.docNode$1;bR!=null&&bR.$==1?(bS=bR.$0,bA.SetOptional(bS,"Render",(bT=bA.GetOptional(bS.Render),bT!=null&&bT.$==1?(bU=bT.$0,{$:1,$0:function(bY){bU(bY);bQ(bY);}}):{$:1,$0:bQ}))):bR!=null&&bR.$==6?(bV=bR.$0,bA.SetOptional(bV,"Render",(bW=bA.GetOptional(bV.Render),bW!=null&&bW.$==1?(bX=bW.$0,{$:1,$0:function(bY){bX(bY);bQ(bY);}}):{$:1,$0:bQ}))):bH.FailWith("Invalid docNode in Elt");return this;},onView:function(bQ,bR,bS){var bT;bT=bS(this.elt);this.elt.addEventListener(bQ,function(bU){return y.Get(bT(bU),bR);},false);return this;},on:function(bQ,bR){this.elt.addEventListener(bQ,function(bS){return bR(bS.target,bS);},false);return this;}},_9,_);_.TreeNode=function(bQ,bR){var bS,bT;function bU(bV){return bV[1];}bS=x.Create(bR);return new _.New$1({$:6,$0:bQ},y.Map2Unit((bT=bs.map(function(bV){return Z.Updates(bU(bV));},bQ.Attrs),e.TreeReduce(y.Const(),y.Map2Unit,bT)),bS.v),bs.get(bQ.Els,0),bS);};_.New=function(bQ,bR,bS){var bT,bU;bT=_8.CreateElemNode(bQ,bR,bS.docNode);bU=x.Create(bS.updates);return new _.New$1({$:1,$0:bT},y.Map2Unit(Z.Updates(bT.Attr),bU.v),bQ,bU);};_.New$1=bA.Ctor(function(bQ,bR,bS,bT){_9.New.call(this,bQ,bR);this.docNode$1=bQ;this.updates$1=bR;this.elt=bS;this.rvUpdates=bT;},_);$=W.EltUpdater=bA.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;w.Set(this.holeUpdates,[]);},RemoveUpdated:function(bQ){var bR,bS;function bT(bU){return bU===bS?false:true;}bR=bQ.docNode;bR!=null&&bR.$==1?(bS=bR.$0.ElKey,this.treeNode.Holes=bs.filter(function(bU){return bU.ElKey!==bS;},this.treeNode.Holes),w.Set(this.holeUpdates,bs.filter(function(bU){return bT(bU[0]);},this.holeUpdates.c))):bH.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bQ){var bR,bS,bT;bR=bQ.docNode;bR!=null&&bR.$==1?(bS=bR.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bS]),bT=this.holeUpdates.c,bT.push([bS.ElKey,bQ.updates]),w.Set(this.holeUpdates,bT)):bH.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];w.Set(this.holeUpdates,[]);},AddHole:function(bQ){this.origHoles.push(bQ);this.treeNode.Holes=this.treeNode.Holes.concat([bQ]);}},_,$);$.New=bA.Ctor(function(bQ,bR,bS,bT,bU){var bV,bW,bX;function bY(bZ){return bZ[1];}_.New$1.call(this,{$:6,$0:bQ},y.Map2Unit(bR,y.BindInner((bV=function(bZ){return bs.map(bY,bZ);},(bW=(bX=y.Const(),function(bZ){return e.TreeReduce(bX,y.Map2Unit,bZ);}),function(bZ){return bW(bV(bZ));})),bU.v)),bS,bT);this.treeNode=bQ;this.holeUpdates=bU;this.origHoles=this.treeNode.Holes;},$);ba.$cctor=function(){ba.$cctor=a.ignore;ba.LoadedTemplates=new bK.New$5();ba.TextHoleRE="\\${([^}]+)}";};bb=d.Flow=bA.Class({get_Render:function(){return this.render;}},b.Obj,bb);bb.New=bA.Ctor(function(bQ){bb.New$1.call(this,function(bR){return function(bS){return w.Set(bR,bQ(bS));};});},bb);bb.New$1=bA.Ctor(function(bQ){this.render=bQ;},bb);bb.get_Do=function(){return new bc.New();};bb.Static=function(bQ){return new bb.New$1(function(bR){return function(bS){w.Set(bR,bQ);return bS();};});};bb.Define=function(bQ){return new bb.New(function(bR){return bQ(function(bS){bR(bS);});});};bb.Embed=function(bQ){var bR;bR=w.Create$1(_9.Empty());((bQ.get_Render())(bR))(a.ignore);return _9.EmbedView(bR.v);};bb.Return=function(bQ){return new bb.New$1(function(){return function(bR){return bR(bQ);};});};bb.Bind=function(bQ,bR){return new bb.New$1(function(bS){return function(bT){return((bQ.get_Render())(bS))(function(bU){((bR(bU).get_Render())(bS))(bT);});};});};bb.Map=function(bQ,bR){return new bb.New$1(function(bS){return function(bT){return((bR.get_Render())(bS))(function(bU){bT(bQ(bU));});};});};bc=d.FlowBuilder=bA.Class({ReturnFrom:a.id,Return:function(bQ){return bb.Return(bQ);},Bind:function(bQ,bR){return bb.Bind(bQ,bR);}},b.Obj,bc);bc.New=bA.Ctor(function(){},bc);be=bd.attr=bA.Class({},b.Obj,be);be.New=bA.Ctor(function(){},be);bf.Append=function(bQ,bR){return{$:0,$0:o.Append(bQ.$0,bR.$0),$1:bE.FoldBack(function(bS,bT,bU){return bU.Add(bS,bT);},bQ.$1,bR.$1)};};bf.FromList=function(bQ,bR){return{$:0,$0:o.FromArray(bs.ofList(bQ)),$1:bR};};bf.ToList=function(bQ){return[br.ofArray(o.ToArray(bQ.$0)),bQ.$1];};bf.SameHash=function(bQ,bR){return bf.NoHash(bQ)===bf.NoHash(bR);};bf.MakeHash=function(bQ){var bR,bS;bR=bQ.$1;bS=bu.concat("/",bs.map(function(bT){return a.encodeURIComponent(bT);},o.ToArray(bQ.$0)));return bR.get_IsEmpty()?bS:bS+"?"+bu.concat("&",by.map(function(bT){var bU;bU=bH.KeyValue(bT);return a.encodeURIComponent(bU[0])+"="+a.encodeURIComponent(bU[1]);},bR));};bf.ParseHash=function(bQ){var bR,bS,bT,bU;bR=bf.NoHash(bQ);bS=(bT=bR.indexOf("?"),bT===-1?[bR,""]:[bP.string(bR,null,{$:1,$0:bT-1}),bP.string(bR,{$:1,$0:bT+1},null)]);bU=bS[0];return{$:0,$0:o.FromArray(bU===""?[]:bs.map(function(bV){return a.decodeURIComponent(bV);},bu.SplitChars(bU,["/"],0))),$1:bE.OfArray(bs.map(function(bV){var bW;bW=bV.indexOf("=");return bW===-1?[a.decodeURIComponent(bV),""]:[a.decodeURIComponent(bP.string(bV,null,{$:1,$0:bW-1})),a.decodeURIComponent(bP.string(bV,{$:1,$0:bW+1},null))];},bu.SplitChars(bS[1],["&"],0)))};};bf.NoHash=function(bQ){return bu.StartsWith(bQ,"#")?bQ.substring(1):bQ;};bh.New=function(bQ,bR,bS,bT){return{Bodies:bQ,CurrentRoute:bR,CurrentSite:bS,Selection:bT};};bg.Install=function(bQ,bR){var bS,bT,bU,bV,bW,bX,bY;function bZ(b2,b3){var b4;b4=b3.$0;return b3.$1({UpdateRoute:function(b5){bg.OnInternalSiteUpdate(bU,b4,b2,b5);}});}function b0(b2){return s.Lookup(bV,(bf.ToList(b2))[0]);}function b1(b2){var b3;b3=b0(b2);b3.$==1?void 0:bg.OnGlobalRouteChange(bU,b3.$0,bf.FromList(b3.$1,new bF.New([])));}bS=bR.$0;bT=bg.InstallMap({Des:function(b2){return bf.FromList(b2[0],b2[1]);},Ser:bf.ToList});bU=bh.New(void 0,bT,0,void 0);bV=s.Map(function(b2){return function(b3){return bZ(b2,b3);};},bR.$1);bU.Bodies=bg.ComputeBodies(bV);bW=(bX=b0(bT.c),bX.$==0?(bY=bX.$0,(bU.CurrentSite=bY.RouteId,w.Create$1(bY.RouteValue))):w.Create$1(bS!=null&&bS.$==1?bS.$0:bH.FailWith("Site.Install fails on empty site")));bU.Selection=bW;y.Sink(function(b2){bg.OnSelectSite(bU,bQ(b2));},bW.v);b1(bT.c);y.Sink(b1,bT.v);return bW;};bg.OnSelectSite=function(bQ,bR){var bS;bS=bR.$0;bQ.CurrentSite!==bS?(bQ.CurrentSite=bS,bQ.Bodies.get_Item(bS).OnSelect()):void 0;};bg.OnInternalSiteUpdate=function(bQ,bR,bS,bT){if(bQ.CurrentSite===bR)bg.SetCurrentRoute(bQ,bf.Append(bf.FromList(bS,new bF.New([])),bT));};bg.OnGlobalRouteChange=function(bQ,bR,bS){bQ.CurrentSite!==bR.RouteId?(bQ.CurrentSite=bR.RouteId,w.Set(bQ.Selection,bR.RouteValue)):void 0;bR.OnRouteChanged(bS);};bg.SetCurrentRoute=function(bQ,bR){if(!bB.Equals(bQ.CurrentRoute.c,bR))w.Set(bQ.CurrentRoute,bR);};bg.ComputeBodies=function(bQ){var bR;bR=new bK.New$5();bs.iter(function(bS){bR.set_Item(bS.RouteId,bS);},s.ToArray(bQ));return bR;};bg.MergeRouters=function(bQ){var bR,bS,bT;bR=e.ofSeqNonCopying(bQ);bS=s.Merge(by.map(function(bU){return bU.$1;},bR));bT=by.tryPick(function(bU){return bU.$0;},bR);return bS!=null&&bS.$==1?{$:0,$0:bT,$1:bS.$0}:bH.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bg.DefineRoute=function(bQ,bR,bS){var bT,bU,bV;bT=w.Create$1(bR);bU=h.Int();bV=bS({$:0,$0:bU},bT);return{$:0,$0:{$:1,$0:bV},$1:s.Leaf({$:0,$0:bU,$1:function(bW){y.Sink(function(bX){bW.UpdateRoute(bg.DoLink(bQ,bX));},bT.v);return{OnRouteChanged:function(bX){w.Set(bT,bg.DoRoute(bQ,bX));},OnSelect:function(){bW.UpdateRoute(bg.DoLink(bQ,bT.c));},RouteId:bU,RouteValue:bV};}})};};bg.DoLink=function(bQ,bR){var bS;bS=bQ.Ser(bR);return bf.FromList(bS[0],bS[1]);};bg.DoRoute=function(bQ,bR){return bQ.Des(bf.ToList(bR));};bg.InstallMap=function(bQ){var bR;function bS(bW,bX){return bB.Equals(bQ.Ser(bW),bQ.Ser(bX));}function bT(){return bQ.Des(bf.ToList(bf.ParseHash(a.location.hash)));}function bU(bW){if(!bS(bR.c,bW))w.Set(bR,bW);}function bV(bW){return bU(bT());}bR=w.Create$1(bT());a.onpopstate=bV;a.onhashchange=bV;y.Sink(function(bW){var bX,bY;bX=bf.MakeHash((bY=bQ.Ser(bW),bf.FromList(bY[0],bY[1])));!bf.SameHash(a.location.hash,bX)?a.location.replace("#"+bX):void 0;},bR.v);return bR;};bi.Install=function(bQ){return bg.InstallMap(bQ);};bi.Create=function(bQ,bR){function bS(bT){return bT[0];}return{Des:function(bT){return bR(bS(bT));},Ser:function(bT){return[bQ(bT),new bF.New([])];}};};bi.CreateWithQuery=function(bQ,bR){return{Des:bR,Ser:bQ};};bj.Route=function(bQ,bR,bS){return bg.DefineRoute(bQ,bR,bS);};bj.Prefix=function(bQ,bR){return{$:0,$0:bR.$0,$1:s.Prefix(bQ,bR.$1)};};bj.Merge=function(bQ){return bg.MergeRouters(bQ);};bj.Install=function(bQ,bR){return bg.Install(bQ,bR);};bj.Dir=function(bQ,bR){return bj.Prefix(bQ,bj.Merge(bR));};bl.New=function(bQ,bR){return{Active:bQ,PosV:bR};};bm.New=function(bQ,bR,bS,bT){return{Active:bQ,Left:bR,Middle:bS,Right:bT};};bn.get_MousePressed=function(){bk.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bA.Curried3(function(bQ,bR,bS){return bQ||bR||bS;})),bk.MouseBtnSt$1().Left.v),bk.MouseBtnSt$1().Middle.v),bk.MouseBtnSt$1().Right.v);};bn.get_RightPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Right.v;};bn.get_MiddlePressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Middle.v;};bn.get_LeftPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Left.v;};bn.get_Position=function(){!bk.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bQ){w.Set(bk.MousePosSt$1().PosV,[bQ.clientX,bQ.clientY]);},false),bk.MousePosSt$1().Active=true):void 0;return bk.MousePosSt$1().PosV.v;};bo.New=function(bQ,bR,bS){return{KeysPressed:bQ,KeyListenerActive:bR,LastPressed:bS};};bp.IsPressed=function(bQ){function bR(bS){return bS===bQ;}bk.ActivateKeyListener();return y.Map(function(bS){return br.exists(bR,bS);},bk.KeyListenerState().KeysPressed.v);};bp.get_LastPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().LastPressed.v;};bp.get_KeysPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().KeysPressed.v;};bk.ActivateKeyListener=function(){bq.$cctor();return bq.ActivateKeyListener;};bk.KeyListenerState=function(){bq.$cctor();return bq.KeyListenerState;};bk.ActivateButtonListener=function(){bq.$cctor();return bq.ActivateButtonListener;};bk.MouseBtnSt$1=function(){bq.$cctor();return bq.MouseBtnSt;};bk.MousePosSt$1=function(){bq.$cctor();return bq.MousePosSt;};bq.$cctor=function(){bq.$cctor=a.ignore;function bQ(bR,bS){var bT;bT=bR.button;return bT===0?w.Set(bk.MouseBtnSt$1().Left,bS):bT===1?w.Set(bk.MouseBtnSt$1().Middle,bS):bT===2?w.Set(bk.MouseBtnSt$1().Right,bS):null;}bq.MousePosSt=bl.New(false,w.Create$1([0,0]));bq.MouseBtnSt=bm.New(false,w.Create$1(false),w.Create$1(false),w.Create$1(false));bq.ActivateButtonListener=!bk.MouseBtnSt$1().Active?(bk.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bR){return bQ(bR,true);},false),a.document.addEventListener("mouseup",function(bR){return bQ(bR,false);},false)):null;bq.KeyListenerState=bo.New(w.Create$1(br.T.Empty),false,w.Create$1(-1));bq.ActivateKeyListener=!bk.KeyListenerState().KeyListenerActive?(bO(a.document).keydown(function(bR){var bS,bT;bS=bR.which;w.Set(bk.KeyListenerState().LastPressed,bS);bT=bk.KeyListenerState().KeysPressed.c;return!br.exists(function(bU){return bU===bS;},bT)?w.Set(bk.KeyListenerState().KeysPressed,br.append(bT,br.ofArray([bS]))):null;}),void bO(a.document).keyup(function(bR){var bS;function bT(bU){return bU!==bS;}bS=bR.which;return w.Update(bk.KeyListenerState().KeysPressed,function(bU){return br.filter(bT,bU);});})):null;};}());
